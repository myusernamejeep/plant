/*! Built with IMPACT - impactjs.com */

(function(window){"use strict";Number.prototype.map=function(istart,istop,ostart,ostop){return ostart+(ostop-ostart)*((this-istart)/(istop-istart));};Number.prototype.limit=function(min,max){return Math.min(max,Math.max(min,this));};Number.prototype.round=function(precision){precision=Math.pow(10,precision||0);return Math.round(this*precision)/precision;};Number.prototype.floor=function(){return Math.floor(this);};Number.prototype.ceil=function(){return Math.ceil(this);};Number.prototype.toInt=function(){return(this|0);};Number.prototype.toRad=function(){return(this/180)*Math.PI;};Number.prototype.toDeg=function(){return(this*180)/Math.PI;};Array.prototype.erase=function(item){for(var i=this.length;i--;){if(this[i]===item){this.splice(i,1);}}
return this;};Array.prototype.random=function(){return this[Math.floor(Math.random()*this.length)];};Function.prototype.bind=Function.prototype.bind||function(bind){var self=this;return function(){var args=Array.prototype.slice.call(arguments);return self.apply(bind||null,args);};};window.ig={game:null,debug:null,version:'1.20',global:window,modules:{},resources:[],ready:false,baked:false,nocache:'',ua:{},prefix:(window.ImpactPrefix||''),lib:'lib/',_current:null,_loadQueue:[],_waitForOnload:0,$:function(selector){return selector.charAt(0)=='#'?document.getElementById(selector.substr(1)):document.getElementsByTagName(selector);},$new:function(name){return document.createElement(name);},copy:function(object){if(!object||typeof(object)!='object'||object instanceof HTMLElement||object instanceof ig.Class){return object;}
else if(object instanceof Array){var c=[];for(var i=0,l=object.length;i<l;i++){c[i]=ig.copy(object[i]);}
return c;}
else{var c={};for(var i in object){c[i]=ig.copy(object[i]);}
return c;}},merge:function(original,extended){for(var key in extended){var ext=extended[key];if(typeof(ext)!='object'||ext instanceof HTMLElement||ext instanceof ig.Class){original[key]=ext;}
else{if(!original[key]||typeof(original[key])!='object'){original[key]=(ext instanceof Array)?[]:{};}
ig.merge(original[key],ext);}}
return original;},ksort:function(obj){if(!obj||typeof(obj)!='object'){return[];}
var keys=[],values=[];for(var i in obj){keys.push(i);}
keys.sort();for(var i=0;i<keys.length;i++){values.push(obj[keys[i]]);}
return values;},module:function(name){if(ig._current){throw("Module '"+ig._current.name+"' defines nothing");}
if(ig.modules[name]&&ig.modules[name].body){throw("Module '"+name+"' is already defined");}
ig._current={name:name,requires:[],loaded:false,body:null};ig.modules[name]=ig._current;ig._loadQueue.push(ig._current);return ig;},requires:function(){ig._current.requires=Array.prototype.slice.call(arguments);return ig;},defines:function(body){ig._current.body=body;ig._current=null;ig._initDOMReady();},addResource:function(resource){ig.resources.push(resource);},setNocache:function(set){ig.nocache=set?'?'+Date.now():'';},log:function(){},assert:function(condition,msg){},show:function(name,number){},mark:function(msg,color){},_loadScript:function(name,requiredFrom){ig.modules[name]={name:name,requires:[],loaded:false,body:null};ig._waitForOnload++;var path=ig.prefix+ig.lib+name.replace(/\./g,'/')+'.js'+ig.nocache;var script=ig.$new('script');script.type='text/javascript';script.src=path;script.onload=function(){ig._waitForOnload--;ig._execModules();};script.onerror=function(){throw('Failed to load module '+name+' at '+path+' '+'required from '+requiredFrom);};ig.$('head')[0].appendChild(script);},_execModules:function(){var modulesLoaded=false;for(var i=0;i<ig._loadQueue.length;i++){var m=ig._loadQueue[i];var dependenciesLoaded=true;for(var j=0;j<m.requires.length;j++){var name=m.requires[j];if(!ig.modules[name]){dependenciesLoaded=false;ig._loadScript(name,m.name);}
else if(!ig.modules[name].loaded){dependenciesLoaded=false;}}
if(dependenciesLoaded&&m.body){ig._loadQueue.splice(i,1);m.loaded=true;m.body();modulesLoaded=true;i--;}}
if(modulesLoaded){ig._execModules();}
else if(!ig.baked&&ig._waitForOnload==0&&ig._loadQueue.length!=0){var unresolved=[];for(var i=0;i<ig._loadQueue.length;i++){var unloaded=[];var requires=ig._loadQueue[i].requires;for(var j=0;j<requires.length;j++){var m=ig.modules[requires[j]];if(!m||!m.loaded){unloaded.push(requires[j]);}}
unresolved.push(ig._loadQueue[i].name+' (requires: '+unloaded.join(', ')+')');}
throw('Unresolved (circular?) dependencies. '+"Most likely there's a name/path mismatch for one of the listed modules:\n"+
unresolved.join('\n'));}},_DOMReady:function(){if(!ig.modules['dom.ready'].loaded){if(!document.body){return setTimeout(ig._DOMReady,13);}
ig.modules['dom.ready'].loaded=true;ig._waitForOnload--;ig._execModules();}
return 0;},_boot:function(){if(document.location.href.match(/\?nocache/)){ig.setNocache(true);}
ig.ua.pixelRatio=window.devicePixelRatio||1;ig.ua.viewport={width:window.innerWidth,height:window.innerHeight};ig.ua.screen={width:window.screen.availWidth*ig.ua.pixelRatio,height:window.screen.availHeight*ig.ua.pixelRatio};ig.ua.iPhone=/iPhone/i.test(navigator.userAgent);ig.ua.iPhone4=(ig.ua.iPhone&&ig.ua.pixelRatio==2);ig.ua.iPad=/iPad/i.test(navigator.userAgent);ig.ua.android=/android/i.test(navigator.userAgent);ig.ua.iOS=ig.ua.iPhone||ig.ua.iPad;ig.ua.mobile=ig.ua.iOS||ig.ua.android;},_initDOMReady:function(){if(ig.modules['dom.ready']){ig._execModules();return;}
ig._boot();ig.modules['dom.ready']={requires:[],loaded:false,body:null};ig._waitForOnload++;if(document.readyState==='complete'){ig._DOMReady();}
else{document.addEventListener('DOMContentLoaded',ig._DOMReady,false);window.addEventListener('load',ig._DOMReady,false);}}};var vendors=['ms','moz','webkit','o'];for(var i=0;i<vendors.length&&!window.requestAnimationFrame;i++){window.requestAnimationFrame=window[vendors[i]+'RequestAnimationFrame'];}
if(window.requestAnimationFrame){var next=1,anims={};window.ig.setAnimation=function(callback,element){var current=next++;anims[current]=true;var animate=function(){if(!anims[current]){return;}
window.requestAnimationFrame(animate,element);callback();};window.requestAnimationFrame(animate,element);return current;};window.ig.clearAnimation=function(id){delete anims[id];};}
else{window.ig.setAnimation=function(callback,element){return window.setInterval(callback,1000/60);};window.ig.clearAnimation=function(id){window.clearInterval(id);};}
var initializing=false,fnTest=/xyz/.test(function(){xyz;})?/\bparent\b/:/.*/;window.ig.Class=function(){};var inject=function(prop){var proto=this.prototype;var parent={};for(var name in prop){if(typeof(prop[name])=="function"&&typeof(proto[name])=="function"&&fnTest.test(prop[name])){parent[name]=proto[name];proto[name]=(function(name,fn){return function(){var tmp=this.parent;this.parent=parent[name];var ret=fn.apply(this,arguments);this.parent=tmp;return ret;};})(name,prop[name]);}
else{proto[name]=prop[name];}}};window.ig.Class.extend=function(prop){var parent=this.prototype;initializing=true;var prototype=new this();initializing=false;for(var name in prop){if(typeof(prop[name])=="function"&&typeof(parent[name])=="function"&&fnTest.test(prop[name])){prototype[name]=(function(name,fn){return function(){var tmp=this.parent;this.parent=parent[name];var ret=fn.apply(this,arguments);this.parent=tmp;return ret;};})(name,prop[name]);}
else{prototype[name]=prop[name];}}
function Class(){if(!initializing){if(this.staticInstantiate){var obj=this.staticInstantiate.apply(this,arguments);if(obj){return obj;}}
for(var p in this){if(typeof(this[p])=='object'){this[p]=ig.copy(this[p]);}}
if(this.init){this.init.apply(this,arguments);}}
return this;}
Class.prototype=prototype;Class.constructor=Class;Class.extend=window.ig.Class.extend;Class.inject=inject;return Class;};})(window);

// lib/impact/image.js
ig.baked=true;ig.module('impact.image').defines(function(){"use strict";ig.Image=ig.Class.extend({data:null,width:0,height:0,loaded:false,failed:false,loadCallback:null,path:'',staticInstantiate:function(path){return ig.Image.cache[path]||null;},init:function(path){this.path=path;this.load();},load:function(loadCallback){if(this.loaded){if(loadCallback){loadCallback(this.path,true);}
return;}
else if(!this.loaded&&ig.ready){this.loadCallback=loadCallback||null;this.data=new Image();this.data.onload=this.onload.bind(this);this.data.onerror=this.onerror.bind(this);this.data.src=ig.prefix+this.path+ig.nocache;}
else{ig.addResource(this);}
ig.Image.cache[this.path]=this;},reload:function(){this.loaded=false;this.data=new Image();this.data.onload=this.onload.bind(this);this.data.src=this.path+'?'+Date.now();},onload:function(event){this.width=this.data.width;this.height=this.data.height;this.loaded=true;if(ig.system.scale!=1){this.resize(ig.system.scale);}
if(this.loadCallback){this.loadCallback(this.path,true);}},onerror:function(event){this.failed=true;if(this.loadCallback){this.loadCallback(this.path,false);}},resize:function(scale){var widthScaled=this.width*scale;var heightScaled=this.height*scale;var orig=ig.$new('canvas');orig.width=this.width;orig.height=this.height;var origCtx=orig.getContext('2d');origCtx.drawImage(this.data,0,0,this.width,this.height,0,0,this.width,this.height);var origPixels=origCtx.getImageData(0,0,this.width,this.height);var scaled=ig.$new('canvas');scaled.width=widthScaled;scaled.height=heightScaled;var scaledCtx=scaled.getContext('2d');var scaledPixels=scaledCtx.getImageData(0,0,widthScaled,heightScaled);for(var y=0;y<heightScaled;y++){for(var x=0;x<widthScaled;x++){var index=(Math.floor(y/scale)*this.width+Math.floor(x/scale))*4;var indexScaled=(y*widthScaled+x)*4;scaledPixels.data[indexScaled]=origPixels.data[index];scaledPixels.data[indexScaled+1]=origPixels.data[index+1];scaledPixels.data[indexScaled+2]=origPixels.data[index+2];scaledPixels.data[indexScaled+3]=origPixels.data[index+3];}}
scaledCtx.putImageData(scaledPixels,0,0);this.data=scaled;},draw:function(targetX,targetY,sourceX,sourceY,width,height){if(!this.loaded){return;}
var scale=ig.system.scale;sourceX=sourceX?sourceX*scale:0;sourceY=sourceY?sourceY*scale:0;width=(width?width:this.width)*scale;height=(height?height:this.height)*scale;ig.system.context.drawImage(this.data,sourceX,sourceY,width,height,ig.system.getDrawPos(targetX),ig.system.getDrawPos(targetY),width,height);ig.Image.drawCount++;},drawTile:function(targetX,targetY,tile,tileWidth,tileHeight,flipX,flipY){tileHeight=tileHeight?tileHeight:tileWidth;if(!this.loaded||tileWidth>this.width||tileHeight>this.height){return;}
var scale=ig.system.scale;var tileWidthScaled=Math.floor(tileWidth*scale);var tileHeightScaled=Math.floor(tileHeight*scale);var scaleX=flipX?-1:1;var scaleY=flipY?-1:1;if(flipX||flipY){ig.system.context.save();ig.system.context.scale(scaleX,scaleY);}
ig.system.context.drawImage(this.data,(Math.floor(tile*tileWidth)%this.width)*scale,(Math.floor(tile*tileWidth/this.width)*tileHeight)*scale,tileWidthScaled,tileHeightScaled,ig.system.getDrawPos(targetX)*scaleX-(flipX?tileWidthScaled:0),ig.system.getDrawPos(targetY)*scaleY-(flipY?tileHeightScaled:0),tileWidthScaled,tileHeightScaled);if(flipX||flipY){ig.system.context.restore();}
ig.Image.drawCount++;}});ig.Image.drawCount=0;ig.Image.cache={};ig.Image.reloadCache=function(){for(var path in ig.Image.cache){ig.Image.cache[path].reload();}};});

// lib/impact/font.js
ig.baked=true;ig.module('impact.font').requires('impact.image').defines(function(){"use strict";ig.Font=ig.Image.extend({widthMap:[],indices:[],firstChar:32,alpha:1,letterSpacing:1,lineSpacing:0,onload:function(ev){this._loadMetrics(this.data);this.parent(ev);},widthForString:function(text){if(text.indexOf('\n')!==-1){var lines=text.split('\n');var width=0;for(var i=0;i<lines.length;i++){width=Math.max(width,this._widthForLine(lines[i]));}
return width;}
else{return this._widthForLine(text);}},_widthForLine:function(text){var width=0;for(var i=0;i<text.length;i++){width+=this.widthMap[text.charCodeAt(i)-this.firstChar]+this.letterSpacing;}
return width;},heightForString:function(text){return text.split('\n').length*(this.height+this.lineSpacing);},draw:function(text,x,y,align){if(typeof(text)!='string'){text=text.toString();}
if(text.indexOf('\n')!==-1){var lines=text.split('\n');var lineHeight=this.height+this.lineSpacing;for(var i=0;i<lines.length;i++){this.draw(lines[i],x,y+i*lineHeight,align);}
return;}
if(align==ig.Font.ALIGN.RIGHT||align==ig.Font.ALIGN.CENTER){var width=this._widthForLine(text);x-=align==ig.Font.ALIGN.CENTER?width/2:width;}
if(this.alpha!==1){ig.system.context.globalAlpha=this.alpha;}
for(var i=0;i<text.length;i++){var c=text.charCodeAt(i);x+=this._drawChar(c-this.firstChar,x,y);}
if(this.alpha!==1){ig.system.context.globalAlpha=1;}
ig.Image.drawCount+=text.length;},_drawChar:function(c,targetX,targetY){if(!this.loaded||c<0||c>=this.indices.length){return 0;}
var scale=ig.system.scale;var charX=this.indices[c]*scale;var charY=0;var charWidth=this.widthMap[c]*scale;var charHeight=(this.height-2)*scale;ig.system.context.drawImage(this.data,charX,charY,charWidth,charHeight,ig.system.getDrawPos(targetX),ig.system.getDrawPos(targetY),charWidth,charHeight);return this.widthMap[c]+this.letterSpacing;},_loadMetrics:function(image){this.height=image.height-1;this.widthMap=[];this.indices=[];var canvas=ig.$new('canvas');canvas.width=image.width;canvas.height=image.height;var ctx=canvas.getContext('2d');ctx.drawImage(image,0,0);var px=ctx.getImageData(0,image.height-1,image.width,1);var currentChar=0;var currentWidth=0;for(var x=0;x<image.width;x++){var index=x*4+3;if(px.data[index]!=0&&px.data[index]!=1){currentWidth++;}
else if((px.data[index]==0||px.data[index]==1)&&currentWidth){this.widthMap.push(currentWidth);this.indices.push(x-currentWidth);currentChar++;currentWidth=0;}}
this.widthMap.push(currentWidth);this.indices.push(x-currentWidth);}});ig.Font.ALIGN={LEFT:0,RIGHT:1,CENTER:2};});

// lib/impact/sound.js
ig.baked=true;ig.module('impact.sound').defines(function(){"use strict";ig.SoundManager=ig.Class.extend({clips:{},volume:1,format:null,init:function(){var probe=new Audio();for(var i=0;i<ig.Sound.use.length;i++){var format=ig.Sound.use[i];if(probe.canPlayType(format.mime)){this.format=format;break;}}
if(!this.format){ig.Sound.enabled=false;}},load:function(path,multiChannel,loadCallback){var realPath=ig.prefix+path.replace(/[^\.]+$/,this.format.ext)+ig.nocache;if(this.clips[path]){if(multiChannel&&this.clips[path].length<ig.Sound.channels){for(var i=this.clips[path].length;i<ig.Sound.channels;i++){var a=new Audio(realPath);a.load();this.clips[path].push(a);}}
return this.clips[path][0];}
var clip=new Audio(realPath);if(loadCallback){clip.addEventListener('canplaythrough',function cb(ev){clip.removeEventListener('canplaythrough',cb,false);loadCallback(path,true,ev);},false);clip.addEventListener('error',function(ev){loadCallback(path,true,ev);},false);}
clip.preload='auto';clip.load();this.clips[path]=[clip];if(multiChannel){for(var i=1;i<ig.Sound.channels;i++){var a=new Audio(realPath);a.load();this.clips[path].push(a);}}
return clip;},get:function(path){var channels=this.clips[path];for(var i=0,clip;clip=channels[i++];){if(clip.paused||clip.ended){if(clip.ended){clip.currentTime=0;}
return clip;}}
channels[0].pause();channels[0].currentTime=0;return channels[0];}});ig.Music=ig.Class.extend({tracks:[],namedTracks:{},currentTrack:null,currentIndex:0,random:false,_volume:1,_loop:false,_fadeInterval:0,_fadeTimer:null,_endedCallbackBound:null,init:function(){this._endedCallbackBound=this._endedCallback.bind(this);if(Object.defineProperty){Object.defineProperty(this,"volume",{get:this.getVolume.bind(this),set:this.setVolume.bind(this)});Object.defineProperty(this,"loop",{get:this.getLooping.bind(this),set:this.setLooping.bind(this)});}
else if(this.__defineGetter__){this.__defineGetter__('volume',this.getVolume.bind(this));this.__defineSetter__('volume',this.setVolume.bind(this));this.__defineGetter__('loop',this.getLooping.bind(this));this.__defineSetter__('loop',this.setLooping.bind(this));}},add:function(music,name){if(!ig.Sound.enabled){return;}
var path=music instanceof ig.Sound?music.path:music;var track=ig.soundManager.load(path,false);track.loop=this._loop;track.volume=this._volume;track.addEventListener('ended',this._endedCallbackBound,false);this.tracks.push(track);if(name){this.namedTracks[name]=track;}
if(!this.currentTrack){this.currentTrack=track;}},next:function(){if(!this.tracks.length){return;}
this.stop();this.currentIndex=this.random?Math.floor(Math.random()*this.tracks.length):(this.currentIndex+1)%this.tracks.length;this.currentTrack=this.tracks[this.currentIndex];this.play();},pause:function(){if(!this.currentTrack){return;}
this.currentTrack.pause();},stop:function(){if(!this.currentTrack){return;}
this.currentTrack.pause();this.currentTrack.currentTime=0;},play:function(name){if(name&&this.namedTracks[name]){var newTrack=this.namedTracks[name];if(newTrack!=this.currentTrack){this.stop();this.currentTrack=newTrack;}}
else if(!this.currentTrack){return;}
this.currentTrack.play();},getLooping:function(){return this._loop;},setLooping:function(l){this._loop=l;for(var i in this.tracks){this.tracks[i].loop=l;}},getVolume:function(){return this._volume;},setVolume:function(v){this._volume=v.limit(0,1);for(var i in this.tracks){this.tracks[i].volume=this._volume;}},fadeOut:function(time){if(!this.currentTrack){return;}
clearInterval(this._fadeInterval);this.fadeTimer=new ig.Timer(time);this._fadeInterval=setInterval(this._fadeStep.bind(this),50);},_fadeStep:function(){var v=this.fadeTimer.delta().map(-this.fadeTimer.target,0,1,0).limit(0,1)*this._volume;if(v<=0.01){this.stop();this.currentTrack.volume=this._volume;clearInterval(this._fadeInterval);}
else{this.currentTrack.volume=v;}},_endedCallback:function(){if(this._loop){this.play();}
else{this.next();}}});ig.Sound=ig.Class.extend({path:'',volume:1,currentClip:null,multiChannel:true,init:function(path,multiChannel){this.path=path;this.multiChannel=(multiChannel!==false);this.load();},load:function(loadCallback){if(!ig.Sound.enabled){if(loadCallback){loadCallback(this.path,true);}
return;}
if(ig.ready){ig.soundManager.load(this.path,this.multiChannel,loadCallback);}
else{ig.addResource(this);}},play:function(){if(!ig.Sound.enabled){return;}
this.currentClip=ig.soundManager.get(this.path);this.currentClip.volume=ig.soundManager.volume*this.volume;this.currentClip.play();},stop:function(){if(this.currentClip){this.currentClip.pause();this.currentClip.currentTime=0;}}});ig.Sound.FORMAT={MP3:{ext:'mp3',mime:'audio/mpeg'},M4A:{ext:'m4a',mime:'audio/mp4; codecs=mp4a'},OGG:{ext:'ogg',mime:'audio/ogg; codecs=vorbis'},WEBM:{ext:'webm',mime:'audio/webm; codecs=vorbis'},CAF:{ext:'caf',mime:'audio/x-caf'}};ig.Sound.use=[ig.Sound.FORMAT.OGG,ig.Sound.FORMAT.MP3];ig.Sound.channels=4;ig.Sound.enabled=true;});

// lib/impact/loader.js
ig.baked=true;ig.module('impact.loader').requires('impact.image','impact.font','impact.sound').defines(function(){"use strict";ig.Loader=ig.Class.extend({resources:[],gameClass:null,status:0,done:false,_unloaded:[],_drawStatus:0,_intervalId:0,_loadCallbackBound:null,init:function(gameClass,resources){this.gameClass=gameClass;this.resources=resources;this._loadCallbackBound=this._loadCallback.bind(this);for(var i=0;i<this.resources.length;i++){this._unloaded.push(this.resources[i].path);}},load:function(){ig.system.clear('#000');if(!this.resources.length){this.end();return;}
for(var i=0;i<this.resources.length;i++){this.loadResource(this.resources[i]);}
this._intervalId=setInterval(this.draw.bind(this),16);},loadResource:function(res){res.load(this._loadCallbackBound);},end:function(){if(this.done){return;}
this.done=true;clearInterval(this._intervalId);ig.system.setGame(this.gameClass);},draw:function(){this._drawStatus+=(this.status-this._drawStatus)/5;var s=ig.system.scale;var w=ig.system.width*0.6;var h=ig.system.height*0.1;var x=ig.system.width*0.5-w/2;var y=ig.system.height*0.5-h/2;ig.system.context.fillStyle='#000';ig.system.context.fillRect(0,0,480,320);ig.system.context.fillStyle='#fff';ig.system.context.fillRect(x*s,y*s,w*s,h*s);ig.system.context.fillStyle='#000';ig.system.context.fillRect(x*s+s,y*s+s,w*s-s-s,h*s-s-s);ig.system.context.fillStyle='#fff';ig.system.context.fillRect(x*s,y*s,w*s*this._drawStatus,h*s);},_loadCallback:function(path,status){if(status){this._unloaded.erase(path);}
else{throw('Failed to load resource: '+path);}
this.status=1-(this._unloaded.length/this.resources.length);if(this._unloaded.length==0){setTimeout(this.end.bind(this),250);}}});});

// lib/impact/timer.js
ig.baked=true;ig.module('impact.timer').defines(function(){"use strict";ig.Timer=ig.Class.extend({target:0,base:0,last:0,pausedAt:0,init:function(seconds){this.base=ig.Timer.time;this.last=ig.Timer.time;this.target=seconds||0;},set:function(seconds){this.target=seconds||0;this.base=ig.Timer.time;this.pausedAt=0;},reset:function(){this.base=ig.Timer.time;this.pausedAt=0;},tick:function(){var delta=ig.Timer.time-this.last;this.last=ig.Timer.time;return(this.pausedAt?0:delta);},delta:function(){return(this.pausedAt||ig.Timer.time)-this.base-this.target;},pause:function(){if(!this.pausedAt){this.pausedAt=ig.Timer.time;}},unpause:function(){if(this.pausedAt){this.base+=ig.Timer.time-this.pausedAt;this.pausedAt=0;}}});ig.Timer._last=0;ig.Timer.time=0;ig.Timer.timeScale=1;ig.Timer.maxStep=0.05;ig.Timer.step=function(){var current=Date.now();var delta=(current-ig.Timer._last)/1000;ig.Timer.time+=Math.min(delta,ig.Timer.maxStep)*ig.Timer.timeScale;ig.Timer._last=current;};});

// lib/impact/system.js
ig.baked=true;ig.module('impact.system').requires('impact.timer','impact.image').defines(function(){"use strict";ig.System=ig.Class.extend({fps:30,width:320,height:240,realWidth:320,realHeight:240,scale:1,tick:0,animationId:0,newGameClass:null,running:false,delegate:null,clock:null,canvas:null,context:null,init:function(canvasId,fps,width,height,scale){this.fps=fps;this.clock=new ig.Timer();this.canvas=ig.$(canvasId);this.resize(width,height,scale);this.context=this.canvas.getContext('2d');this.getDrawPos=ig.System.drawMode;},resize:function(width,height,scale){this.width=width;this.height=height;this.scale=scale||this.scale;this.realWidth=this.width*this.scale;this.realHeight=this.height*this.scale;this.canvas.width=this.realWidth;this.canvas.height=this.realHeight;},setGame:function(gameClass){if(this.running){this.newGameClass=gameClass;}
else{this.setGameNow(gameClass);}},setGameNow:function(gameClass){ig.game=new(gameClass)();ig.system.setDelegate(ig.game);},setDelegate:function(object){if(typeof(object.run)=='function'){this.delegate=object;this.startRunLoop();}else{throw('System.setDelegate: No run() function in object');}},stopRunLoop:function(){ig.clearAnimation(this.animationId);this.running=false;},startRunLoop:function(){this.stopRunLoop();this.animationId=ig.setAnimation(this.run.bind(this),this.canvas);this.running=true;},clear:function(color){this.context.fillStyle=color;this.context.fillRect(0,0,this.realWidth,this.realHeight);},run:function(){ig.Timer.step();this.tick=this.clock.tick();this.delegate.run();ig.input.clearPressed();if(this.newGameClass){this.setGameNow(this.newGameClass);this.newGameClass=null;}},getDrawPos:null,});ig.System.DRAW={AUTHENTIC:function(p){return Math.round(p)*this.scale;},SMOOTH:function(p){return Math.round(p*this.scale);},SUBPIXEL:function(p){return p*this.scale;}};ig.System.drawMode=ig.System.DRAW.SMOOTH;});

// lib/impact/input.js
ig.baked=true;ig.module('impact.input').defines(function(){"use strict";ig.KEY={'MOUSE1':-1,'MOUSE2':-3,'MWHEEL_UP':-4,'MWHEEL_DOWN':-5,'BACKSPACE':8,'TAB':9,'ENTER':13,'PAUSE':19,'CAPS':20,'ESC':27,'SPACE':32,'PAGE_UP':33,'PAGE_DOWN':34,'END':35,'HOME':36,'LEFT_ARROW':37,'UP_ARROW':38,'RIGHT_ARROW':39,'DOWN_ARROW':40,'INSERT':45,'DELETE':46,'_0':48,'_1':49,'_2':50,'_3':51,'_4':52,'_5':53,'_6':54,'_7':55,'_8':56,'_9':57,'A':65,'B':66,'C':67,'D':68,'E':69,'F':70,'G':71,'H':72,'I':73,'J':74,'K':75,'L':76,'M':77,'N':78,'O':79,'P':80,'Q':81,'R':82,'S':83,'T':84,'U':85,'V':86,'W':87,'X':88,'Y':89,'Z':90,'NUMPAD_0':96,'NUMPAD_1':97,'NUMPAD_2':98,'NUMPAD_3':99,'NUMPAD_4':100,'NUMPAD_5':101,'NUMPAD_6':102,'NUMPAD_7':103,'NUMPAD_8':104,'NUMPAD_9':105,'MULTIPLY':106,'ADD':107,'SUBSTRACT':109,'DECIMAL':110,'DIVIDE':111,'F1':112,'F2':113,'F3':114,'F4':115,'F5':116,'F6':117,'F7':118,'F8':119,'F9':120,'F10':121,'F11':122,'F12':123,'SHIFT':16,'CTRL':17,'ALT':18,'PLUS':187,'COMMA':188,'MINUS':189,'PERIOD':190};ig.Input=ig.Class.extend({bindings:{},actions:{},presses:{},locks:{},delayedKeyup:{},isUsingMouse:false,isUsingKeyboard:false,isUsingAccelerometer:false,mouse:{x:0,y:0},accel:{x:0,y:0,z:0},initMouse:function(){if(this.isUsingMouse){return;}
this.isUsingMouse=true;var mouseWheelBound=this.mousewheel.bind(this);ig.system.canvas.addEventListener('mousewheel',mouseWheelBound,false);ig.system.canvas.addEventListener('DOMMouseScroll',mouseWheelBound,false);ig.system.canvas.addEventListener('contextmenu',this.contextmenu.bind(this),false);ig.system.canvas.addEventListener('mousedown',this.keydown.bind(this),false);ig.system.canvas.addEventListener('mouseup',this.keyup.bind(this),false);ig.system.canvas.addEventListener('mousemove',this.mousemove.bind(this),false);ig.system.canvas.addEventListener('touchstart',this.keydown.bind(this),false);ig.system.canvas.addEventListener('touchend',this.keyup.bind(this),false);ig.system.canvas.addEventListener('touchmove',this.mousemove.bind(this),false);},initKeyboard:function(){if(this.isUsingKeyboard){return;}
this.isUsingKeyboard=true;window.addEventListener('keydown',this.keydown.bind(this),false);window.addEventListener('keyup',this.keyup.bind(this),false);},initAccelerometer:function(){if(this.isUsingAccelerometer){return;}
window.addEventListener('devicemotion',this.devicemotion.bind(this),false);},mousewheel:function(event){var delta=event.wheelDelta?event.wheelDelta:(event.detail*-1);var code=delta>0?ig.KEY.MWHEEL_UP:ig.KEY.MWHEEL_DOWN;var action=this.bindings[code];if(action){this.actions[action]=true;this.presses[action]=true;this.delayedKeyup[action]=true;event.stopPropagation();event.preventDefault();}},mousemove:function(event){var el=ig.system.canvas;var pos={left:0,top:0};while(el!=null){pos.left+=el.offsetLeft;pos.top+=el.offsetTop;el=el.offsetParent;}
var tx=event.pageX;var ty=event.pageY;if(event.touches){tx=event.touches[0].clientX;ty=event.touches[0].clientY;}
this.mouse.x=(tx-pos.left)/ig.system.scale;this.mouse.y=(ty-pos.top)/ig.system.scale;},contextmenu:function(event){if(this.bindings[ig.KEY.MOUSE2]){event.stopPropagation();event.preventDefault();}},keydown:function(event){if(event.target.type=='text'){return;}
var code=event.type=='keydown'?event.keyCode:(event.button==2?ig.KEY.MOUSE2:ig.KEY.MOUSE1);if(event.type=='touchstart'||event.type=='mousedown'){this.mousemove(event);}
var action=this.bindings[code];if(action){this.actions[action]=true;if(!this.locks[action]){this.presses[action]=true;this.locks[action]=true;}
event.stopPropagation();event.preventDefault();}},keyup:function(event){if(event.target.type=='text'){return;}
var code=event.type=='keyup'?event.keyCode:(event.button==2?ig.KEY.MOUSE2:ig.KEY.MOUSE1);var action=this.bindings[code];if(action){this.delayedKeyup[action]=true;event.stopPropagation();event.preventDefault();}},devicemotion:function(event){this.accel=event.accelerationIncludingGravity;},bind:function(key,action){if(key<0){this.initMouse();}
else if(key>0){this.initKeyboard();}
this.bindings[key]=action;},bindTouch:function(selector,action){var element=ig.$(selector);var that=this;element.addEventListener('touchstart',function(ev){that.touchStart(ev,action);},false);element.addEventListener('touchend',function(ev){that.touchEnd(ev,action);},false);},unbind:function(key){var action=this.bindings[key];this.delayedKeyup[action]=true;this.bindings[key]=null;},unbindAll:function(){this.bindings={};this.actions={};this.presses={};this.locks={};this.delayedKeyup={};},state:function(action){return this.actions[action];},pressed:function(action){return this.presses[action];},released:function(action){return this.delayedKeyup[action];},clearPressed:function(){for(var action in this.delayedKeyup){this.actions[action]=false;this.locks[action]=false;}
this.delayedKeyup={};this.presses={};},touchStart:function(event,action){this.actions[action]=true;this.presses[action]=true;event.stopPropagation();event.preventDefault();return false;},touchEnd:function(event,action){this.delayedKeyup[action]=true;event.stopPropagation();event.preventDefault();return false;}});});

// lib/impact/impact.js
ig.baked=true;ig.module('impact.impact').requires('dom.ready','impact.loader','impact.system','impact.input','impact.sound').defines(function(){"use strict";ig.main=function(canvasId,gameClass,fps,width,height,scale,loaderClass){ig.system=new ig.System(canvasId,fps,width,height,scale||1);ig.input=new ig.Input();ig.soundManager=new ig.SoundManager();ig.music=new ig.Music();ig.ready=true;var loader=new(loaderClass||ig.Loader)(gameClass,ig.resources);loader.load();};});var State={score:0};var isMobile=false;var Config={gameSpeed:1,size:{x:960,y:640}}


// lib/impact/animation.js
ig.baked=true;ig.module('impact.animation').requires('impact.timer','impact.image').defines(function(){"use strict";ig.AnimationSheet=ig.Class.extend({width:8,height:8,image:null,init:function(path,width,height){this.width=width;this.height=height;this.image=new ig.Image(path);}});ig.Animation=ig.Class.extend({sheet:null,timer:null,sequence:[],flip:{x:false,y:false},pivot:{x:0,y:0},frame:0,tile:0,loopCount:0,alpha:1,angle:0,init:function(sheet,frameTime,sequence,stop){this.sheet=sheet;this.pivot={x:sheet.width/2,y:sheet.height/2};this.timer=new ig.Timer();this.frameTime=frameTime;this.sequence=sequence;this.stop=!!stop;this.tile=this.sequence[0];},rewind:function(){this.timer.reset();this.loopCount=0;this.tile=this.sequence[0];return this;},gotoFrame:function(f){this.timer.set(this.frameTime*-f);this.update();},gotoRandomFrame:function(){this.gotoFrame(Math.floor(Math.random()*this.sequence.length))},update:function(){var frameTotal=Math.floor(this.timer.delta()/this.frameTime);this.loopCount=Math.floor(frameTotal/this.sequence.length);if(this.stop&&this.loopCount>0){this.frame=this.sequence.length-1;}
else{this.frame=frameTotal%this.sequence.length;}
this.tile=this.sequence[this.frame];},draw:function(targetX,targetY){var bbsize=Math.max(this.sheet.width,this.sheet.height);if(targetX>ig.system.width||targetY>ig.system.height||targetX+bbsize<0||targetY+bbsize<0){return;}
if(this.alpha!=1){ig.system.context.globalAlpha=this.alpha;}
if(this.angle==0){this.sheet.image.drawTile(targetX,targetY,this.tile,this.sheet.width,this.sheet.height,this.flip.x,this.flip.y);}
else{ig.system.context.save();ig.system.context.translate(ig.system.getDrawPos(targetX+this.pivot.x),ig.system.getDrawPos(targetY+this.pivot.y));ig.system.context.rotate(this.angle);this.sheet.image.drawTile(-this.pivot.x,-this.pivot.y,this.tile,this.sheet.width,this.sheet.height,this.flip.x,this.flip.y);ig.system.context.restore();}
if(this.alpha!=1){ig.system.context.globalAlpha=1;}}});});

// lib/impact/entity.js
ig.baked=true;ig.module('impact.entity').requires('impact.animation','impact.impact').defines(function(){"use strict";ig.Entity=ig.Class.extend({id:0,settings:{},size:{x:16,y:16},offset:{x:0,y:0},pos:{x:0,y:0},last:{x:0,y:0},vel:{x:0,y:0},accel:{x:0,y:0},friction:{x:0,y:0},maxVel:{x:100,y:100},zIndex:0,gravityFactor:1,standing:false,bounciness:0,minBounceVelocity:40,anims:{},animSheet:null,currentAnim:null,health:10,type:0,checkAgainst:0,collides:0,_killed:false,slopeStanding:{min:(44).toRad(),max:(136).toRad()},init:function(x,y,settings){this.id=++ig.Entity._lastId;this.pos.x=x;this.pos.y=y;ig.merge(this,settings);},addAnim:function(name,frameTime,sequence,stop){if(!this.animSheet){throw('No animSheet to add the animation '+name+' to.');}
var a=new ig.Animation(this.animSheet,frameTime,sequence,stop);this.anims[name]=a;if(!this.currentAnim){this.currentAnim=a;}
return a;},update:function(){this.last.x=this.pos.x;this.last.y=this.pos.y;this.vel.y+=ig.game.gravity*ig.system.tick*this.gravityFactor;this.vel.x=this.getNewVelocity(this.vel.x,this.accel.x,this.friction.x,this.maxVel.x);this.vel.y=this.getNewVelocity(this.vel.y,this.accel.y,this.friction.y,this.maxVel.y);var mx=this.vel.x*ig.system.tick;var my=this.vel.y*ig.system.tick;var res=ig.game.collisionMap.trace(this.pos.x,this.pos.y,mx,my,this.size.x,this.size.y);this.handleMovementTrace(res);if(this.currentAnim){this.currentAnim.update();}},getNewVelocity:function(vel,accel,friction,max){if(accel){return(vel+accel*ig.system.tick).limit(-max,max);}
else if(friction){var delta=friction*ig.system.tick;if(vel-delta>0){return vel-delta;}
else if(vel+delta<0){return vel+delta;}
else{return 0;}}
return vel.limit(-max,max);},handleMovementTrace:function(res){this.standing=false;if(res.collision.y){if(this.bounciness>0&&Math.abs(this.vel.y)>this.minBounceVelocity){this.vel.y*=-this.bounciness;}
else{if(this.vel.y>0){this.standing=true;}
this.vel.y=0;}}
if(res.collision.x){if(this.bounciness>0&&Math.abs(this.vel.x)>this.minBounceVelocity){this.vel.x*=-this.bounciness;}
else{this.vel.x=0;}}
if(res.collision.slope){var s=res.collision.slope;if(this.bounciness>0){var proj=this.vel.x*s.nx+this.vel.y*s.ny;this.vel.x=(this.vel.x-s.nx*proj*2)*this.bounciness;this.vel.y=(this.vel.y-s.ny*proj*2)*this.bounciness;}
else{var lengthSquared=s.x*s.x+s.y*s.y;var dot=(this.vel.x*s.x+this.vel.y*s.y)/lengthSquared;this.vel.x=s.x*dot;this.vel.y=s.y*dot;var angle=Math.atan2(s.x,s.y);if(angle>this.slopeStanding.min&&angle<this.slopeStanding.max){this.standing=true;}}}
this.pos=res.pos;},draw:function(){if(this.currentAnim){this.currentAnim.draw(this.pos.x-this.offset.x-ig.game._rscreen.x,this.pos.y-this.offset.y-ig.game._rscreen.y);}},kill:function(){ig.game.removeEntity(this);},receiveDamage:function(amount,from){this.health-=amount;if(this.health<=0){this.kill();}},touches:function(other){return!(this.pos.x>=other.pos.x+other.size.x||this.pos.x+this.size.x<=other.pos.x||this.pos.y>=other.pos.y+other.size.y||this.pos.y+this.size.y<=other.pos.y);},distanceTo:function(other){var xd=(this.pos.x+this.size.x/2)-(other.pos.x+other.size.x/2);var yd=(this.pos.y+this.size.y/2)-(other.pos.y+other.size.y/2);return Math.sqrt(xd*xd+yd*yd);},angleTo:function(other){return Math.atan2((other.pos.y+other.size.y/2)-(this.pos.y+this.size.y/2),(other.pos.x+other.size.x/2)-(this.pos.x+this.size.x/2));},check:function(other){},collideWith:function(other,axis){},ready:function(){}});ig.Entity._lastId=0;ig.Entity.COLLIDES={NEVER:0,LITE:1,PASSIVE:2,ACTIVE:4,FIXED:8};ig.Entity.TYPE={NONE:0,A:1,B:2,BOTH:3};ig.Entity.checkPair=function(a,b){if(a.checkAgainst&b.type){a.check(b);}
if(b.checkAgainst&a.type){b.check(a);}
if(a.collides&&b.collides&&a.collides+b.collides>ig.Entity.COLLIDES.ACTIVE){ig.Entity.solveCollision(a,b);}};ig.Entity.solveCollision=function(a,b){var weak=null;if(a.collides==ig.Entity.COLLIDES.LITE||b.collides==ig.Entity.COLLIDES.FIXED){weak=a;}
else if(b.collides==ig.Entity.COLLIDES.LITE||a.collides==ig.Entity.COLLIDES.FIXED){weak=b;}
if(a.last.x+a.size.x>b.last.x&&a.last.x<b.last.x+b.size.x){if(a.last.y<b.last.y){ig.Entity.seperateOnYAxis(a,b,weak);}
else{ig.Entity.seperateOnYAxis(b,a,weak);}
a.collideWith(b,'y');b.collideWith(a,'y');}
else if(a.last.y+a.size.y>b.last.y&&a.last.y<b.last.y+b.size.y){if(a.last.x<b.last.x){ig.Entity.seperateOnXAxis(a,b,weak);}
else{ig.Entity.seperateOnXAxis(b,a,weak);}
a.collideWith(b,'x');b.collideWith(a,'x');}};ig.Entity.seperateOnXAxis=function(left,right,weak){var nudge=(left.pos.x+left.size.x-right.pos.x);if(weak){var strong=left===weak?right:left;weak.vel.x=-weak.vel.x*weak.bounciness+strong.vel.x;var resWeak=ig.game.collisionMap.trace(weak.pos.x,weak.pos.y,weak==left?-nudge:nudge,0,weak.size.x,weak.size.y);weak.pos.x=resWeak.pos.x;}
else{var v2=(left.vel.x-right.vel.x)/2;left.vel.x=-v2;right.vel.x=v2;var resLeft=ig.game.collisionMap.trace(left.pos.x,left.pos.y,-nudge/2,0,left.size.x,left.size.y);left.pos.x=Math.floor(resLeft.pos.x);var resRight=ig.game.collisionMap.trace(right.pos.x,right.pos.y,nudge/2,0,right.size.x,right.size.y);right.pos.x=Math.ceil(resRight.pos.x);}};ig.Entity.seperateOnYAxis=function(top,bottom,weak){var nudge=(top.pos.y+top.size.y-bottom.pos.y);if(weak){var strong=top===weak?bottom:top;weak.vel.y=-weak.vel.y*weak.bounciness+strong.vel.y;var nudgeX=0;if(weak==top&&Math.abs(weak.vel.y-strong.vel.y)<weak.minBounceVelocity){weak.standing=true;nudgeX=strong.vel.x*ig.system.tick;}
var resWeak=ig.game.collisionMap.trace(weak.pos.x,weak.pos.y,nudgeX,weak==top?-nudge:nudge,weak.size.x,weak.size.y);weak.pos.y=resWeak.pos.y;weak.pos.x=resWeak.pos.x;}
else if(ig.game.gravity&&(bottom.standing||top.vel.y>0)){var resTop=ig.game.collisionMap.trace(top.pos.x,top.pos.y,0,-(top.pos.y+top.size.y-bottom.pos.y),top.size.x,top.size.y);top.pos.y=resTop.pos.y;if(top.bounciness>0&&top.vel.y>top.minBounceVelocity){top.vel.y*=-top.bounciness;}
else{top.standing=true;top.vel.y=0;}}
else{var v2=(top.vel.y-bottom.vel.y)/2;top.vel.y=-v2;bottom.vel.y=v2;var nudgeX=bottom.vel.x*ig.system.tick;var resTop=ig.game.collisionMap.trace(top.pos.x,top.pos.y,nudgeX,-nudge/2,top.size.x,top.size.y);top.pos.y=resTop.pos.y;var resBottom=ig.game.collisionMap.trace(bottom.pos.x,bottom.pos.y,0,nudge/2,bottom.size.x,bottom.size.y);bottom.pos.y=resBottom.pos.y;}};});

// lib/impact/map.js
ig.baked=true;ig.module('impact.map').defines(function(){"use strict";ig.Map=ig.Class.extend({tilesize:8,width:1,height:1,data:[[]],name:null,init:function(tilesize,data){this.tilesize=tilesize;this.data=data;this.height=data.length;this.width=data[0].length;},getTile:function(x,y){var tx=Math.floor(x/this.tilesize);var ty=Math.floor(y/this.tilesize);if((tx>=0&&tx<this.width)&&(ty>=0&&ty<this.height)){return this.data[ty][tx];}
else{return 0;}},setTile:function(x,y,tile){var tx=Math.floor(x/this.tilesize);var ty=Math.floor(y/this.tilesize);if((tx>=0&&tx<this.width)&&(ty>=0&&ty<this.height)){this.data[ty][tx]=tile;}}});});

// lib/impact/collision-map.js
ig.baked=true;ig.module('impact.collision-map').requires('impact.map').defines(function(){"use strict";ig.CollisionMap=ig.Map.extend({lastSlope:1,tiledef:null,init:function(tilesize,data,tiledef){this.parent(tilesize,data);this.tiledef=tiledef||ig.CollisionMap.defaultTileDef;for(var t in this.tiledef){if(t|0>this.lastSlope){this.lastSlope=t|0;}}},trace:function(x,y,vx,vy,objectWidth,objectHeight){var res={collision:{x:false,y:false,slope:false},pos:{x:x,y:y},tile:{x:0,y:0}};var steps=Math.ceil(Math.max(Math.abs(vx),Math.abs(vy))/this.tilesize);if(steps>1){var sx=vx/steps;var sy=vy/steps;for(var i=0;i<steps&&(sx||sy);i++){this._traceStep(res,x,y,sx,sy,objectWidth,objectHeight,vx,vy,i);x=res.pos.x;y=res.pos.y;if(res.collision.x){sx=0;vx=0;}
if(res.collision.y){sy=0;vy=0;}
if(res.collision.slope){break;}}}
else{this._traceStep(res,x,y,vx,vy,objectWidth,objectHeight,vx,vy,0);}
return res;},_traceStep:function(res,x,y,vx,vy,width,height,rvx,rvy,step){res.pos.x+=vx;res.pos.y+=vy;var t=0;if(vx){var pxOffsetX=(vx>0?width:0);var tileOffsetX=(vx<0?this.tilesize:0);var firstTileY=Math.max(Math.floor(y/this.tilesize),0);var lastTileY=Math.min(Math.ceil((y+height)/this.tilesize),this.height);var tileX=Math.floor((res.pos.x+pxOffsetX)/this.tilesize);var prevTileX=Math.floor((x+pxOffsetX)/this.tilesize);if(step>0||tileX==prevTileX||prevTileX<0||prevTileX>=this.width){prevTileX=-1;}
if(tileX>=0&&tileX<this.width){for(var tileY=firstTileY;tileY<lastTileY;tileY++){if(prevTileX!=-1){t=this.data[tileY][prevTileX];if(t>1&&t<=this.lastSlope&&this._checkTileDef(res,t,x,y,rvx,rvy,width,height,prevTileX,tileY)){break;}}
t=this.data[tileY][tileX];if(t==1||t>this.lastSlope||(t>1&&this._checkTileDef(res,t,x,y,rvx,rvy,width,height,tileX,tileY))){if(t>1&&t<=this.lastSlope&&res.collision.slope){break;}
res.collision.x=true;res.tile.x=t;x=res.pos.x=tileX*this.tilesize-pxOffsetX+tileOffsetX;rvx=0;break;}}}}
if(vy){var pxOffsetY=(vy>0?height:0);var tileOffsetY=(vy<0?this.tilesize:0);var firstTileX=Math.max(Math.floor(res.pos.x/this.tilesize),0);var lastTileX=Math.min(Math.ceil((res.pos.x+width)/this.tilesize),this.width);var tileY=Math.floor((res.pos.y+pxOffsetY)/this.tilesize);var prevTileY=Math.floor((y+pxOffsetY)/this.tilesize);if(step>0||tileY==prevTileY||prevTileY<0||prevTileY>=this.height){prevTileY=-1;}
if(tileY>=0&&tileY<this.height){for(var tileX=firstTileX;tileX<lastTileX;tileX++){if(prevTileY!=-1){t=this.data[prevTileY][tileX];if(t>1&&t<=this.lastSlope&&this._checkTileDef(res,t,x,y,rvx,rvy,width,height,tileX,prevTileY)){break;}}
t=this.data[tileY][tileX];if(t==1||t>this.lastSlope||(t>1&&this._checkTileDef(res,t,x,y,rvx,rvy,width,height,tileX,tileY))){if(t>1&&t<=this.lastSlope&&res.collision.slope){break;}
res.collision.y=true;res.tile.y=t;res.pos.y=tileY*this.tilesize-pxOffsetY+tileOffsetY;break;}}}}},_checkTileDef:function(res,t,x,y,vx,vy,width,height,tileX,tileY){var def=this.tiledef[t];if(!def){return false;}
var lx=(tileX+def[0])*this.tilesize,ly=(tileY+def[1])*this.tilesize,lvx=(def[2]-def[0])*this.tilesize,lvy=(def[3]-def[1])*this.tilesize,solid=def[4];var tx=x+vx+(lvy<0?width:0)-lx,ty=y+vy+(lvx>0?height:0)-ly;if(lvx*ty-lvy*tx>0){if(vx*-lvy+vy*lvx<0){return solid;}
var length=Math.sqrt(lvx*lvx+lvy*lvy);var nx=lvy/length,ny=-lvx/length;var proj=tx*nx+ty*ny;var px=nx*proj,py=ny*proj;if(px*px+py*py>=vx*vx+vy*vy){return solid||(lvx*(ty-vy)-lvy*(tx-vx)<0.5);}
res.pos.x=x+vx-px;res.pos.y=y+vy-py;res.collision.slope={x:lvx,y:lvy,nx:nx,ny:ny};return true;}
return false;}});var H=1/2,N=1/3,M=2/3,SOLID=true,NON_SOLID=false;ig.CollisionMap.defaultTileDef={5:[0,1,1,M,SOLID],6:[0,M,1,N,SOLID],7:[0,N,1,0,SOLID],3:[0,1,1,H,SOLID],4:[0,H,1,0,SOLID],2:[0,1,1,0,SOLID],10:[H,1,1,0,SOLID],21:[0,1,H,0,SOLID],32:[M,1,1,0,SOLID],43:[N,1,M,0,SOLID],54:[0,1,N,0,SOLID],27:[0,0,1,N,SOLID],28:[0,N,1,M,SOLID],29:[0,M,1,1,SOLID],25:[0,0,1,H,SOLID],26:[0,H,1,1,SOLID],24:[0,0,1,1,SOLID],11:[0,0,H,1,SOLID],22:[H,0,1,1,SOLID],33:[0,0,N,1,SOLID],44:[N,0,M,1,SOLID],55:[M,0,1,1,SOLID],16:[1,N,0,0,SOLID],17:[1,M,0,N,SOLID],18:[1,1,0,M,SOLID],14:[1,H,0,0,SOLID],15:[1,1,0,H,SOLID],13:[1,1,0,0,SOLID],8:[H,1,0,0,SOLID],19:[1,1,H,0,SOLID],30:[N,1,0,0,SOLID],41:[M,1,N,0,SOLID],52:[1,1,M,0,SOLID],38:[1,M,0,1,SOLID],39:[1,N,0,M,SOLID],40:[1,0,0,N,SOLID],36:[1,H,0,1,SOLID],37:[1,0,0,H,SOLID],35:[1,0,0,1,SOLID],9:[1,0,H,1,SOLID],20:[H,0,0,1,SOLID],31:[1,0,M,1,SOLID],42:[M,0,N,1,SOLID],53:[N,0,0,1,SOLID],12:[0,0,1,0,NON_SOLID],23:[1,1,0,1,NON_SOLID],34:[1,0,1,1,NON_SOLID],45:[0,1,0,0,NON_SOLID]};ig.CollisionMap.staticNoCollision={trace:function(x,y,vx,vy){return{collision:{x:false,y:false,slope:false},pos:{x:x+vx,y:y+vy},tile:{x:0,y:0}};}};});

// lib/impact/background-map.js
ig.baked=true;ig.module('impact.background-map').requires('impact.map','impact.image').defines(function(){"use strict";ig.BackgroundMap=ig.Map.extend({tiles:null,scroll:{x:0,y:0},distance:1,repeat:false,tilesetName:'',foreground:false,enabled:true,preRender:false,preRenderedChunks:null,chunkSize:512,debugChunks:false,anims:{},init:function(tilesize,data,tileset){this.parent(tilesize,data);this.setTileset(tileset);},setTileset:function(tileset){this.tilesetName=tileset instanceof ig.Image?tileset.path:tileset;this.tiles=new ig.Image(this.tilesetName);this.preRenderedChunks=null;},setScreenPos:function(x,y){this.scroll.x=x/this.distance;this.scroll.y=y/this.distance;},preRenderMapToChunks:function(){var totalWidth=this.width*this.tilesize*ig.system.scale,totalHeight=this.height*this.tilesize*ig.system.scale;var chunkCols=Math.ceil(totalWidth/this.chunkSize),chunkRows=Math.ceil(totalHeight/this.chunkSize);this.preRenderedChunks=[];for(var y=0;y<chunkRows;y++){this.preRenderedChunks[y]=[];for(var x=0;x<chunkCols;x++){var chunkWidth=(x==chunkCols-1)?totalWidth-x*this.chunkSize:this.chunkSize;var chunkHeight=(y==chunkRows-1)?totalHeight-y*this.chunkSize:this.chunkSize;this.preRenderedChunks[y][x]=this.preRenderChunk(x,y,chunkWidth,chunkHeight);}}},preRenderChunk:function(cx,cy,w,h){var tw=w/this.tilesize/ig.system.scale+1,th=h/this.tilesize/ig.system.scale+1;var nx=(cx*this.chunkSize/ig.system.scale)%this.tilesize,ny=(cy*this.chunkSize/ig.system.scale)%this.tilesize;var tx=Math.floor(cx*this.chunkSize/this.tilesize/ig.system.scale),ty=Math.floor(cy*this.chunkSize/this.tilesize/ig.system.scale);var chunk=ig.$new('canvas');chunk.width=w;chunk.height=h;var oldContext=ig.system.context;ig.system.context=chunk.getContext("2d");for(var x=0;x<tw;x++){for(var y=0;y<th;y++){if(x+tx<this.width&&y+ty<this.height){var tile=this.data[y+ty][x+tx];if(tile){this.tiles.drawTile(x*this.tilesize-nx,y*this.tilesize-ny,tile-1,this.tilesize);}}}}
ig.system.context=oldContext;return chunk;},draw:function(){if(!this.tiles.loaded||!this.enabled){return;}
if(this.preRender){this.drawPreRendered();}
else{this.drawTiled();}},drawPreRendered:function(){if(!this.preRenderedChunks){this.preRenderMapToChunks();}
var dx=ig.system.getDrawPos(this.scroll.x),dy=ig.system.getDrawPos(this.scroll.y);if(this.repeat){dx%=this.width*this.tilesize*ig.system.scale;dy%=this.height*this.tilesize*ig.system.scale;}
var minChunkX=Math.max(Math.floor(dx/this.chunkSize),0),minChunkY=Math.max(Math.floor(dy/this.chunkSize),0),maxChunkX=Math.ceil((dx+ig.system.realWidth)/this.chunkSize),maxChunkY=Math.ceil((dy+ig.system.realHeight)/this.chunkSize),maxRealChunkX=this.preRenderedChunks[0].length,maxRealChunkY=this.preRenderedChunks.length;if(!this.repeat){maxChunkX=Math.min(maxChunkX,maxRealChunkX);maxChunkY=Math.min(maxChunkY,maxRealChunkY);}
var nudgeY=0;for(var cy=minChunkY;cy<maxChunkY;cy++){var nudgeX=0;for(var cx=minChunkX;cx<maxChunkX;cx++){var chunk=this.preRenderedChunks[cy%maxRealChunkY][cx%maxRealChunkX];var x=-dx+cx*this.chunkSize-nudgeX;var y=-dy+cy*this.chunkSize-nudgeY;ig.system.context.drawImage(chunk,x,y);ig.Image.drawCount++;if(this.debugChunks){ig.system.context.strokeStyle='#f0f';ig.system.context.strokeRect(x,y,this.chunkSize,this.chunkSize);}
if(this.repeat&&chunk.width<this.chunkSize&&x+chunk.width<ig.system.realWidth){nudgeX=this.chunkSize-chunk.width;maxChunkX++;}}
if(this.repeat&&chunk.height<this.chunkSize&&y+chunk.height<ig.system.realHeight){nudgeY=this.chunkSize-chunk.height;maxChunkY++;}}},drawTiled:function(){var tile=0,anim=null,tileOffsetX=(this.scroll.x/this.tilesize).toInt(),tileOffsetY=(this.scroll.y/this.tilesize).toInt(),pxOffsetX=this.scroll.x%this.tilesize,pxOffsetY=this.scroll.y%this.tilesize,pxMinX=-pxOffsetX-this.tilesize,pxMinY=-pxOffsetY-this.tilesize,pxMaxX=ig.system.width+this.tilesize-pxOffsetX,pxMaxY=ig.system.height+this.tilesize-pxOffsetY;for(var mapY=-1,pxY=pxMinY;pxY<pxMaxY;mapY++,pxY+=this.tilesize){var tileY=mapY+tileOffsetY;if(tileY>=this.height||tileY<0){if(!this.repeat){continue;}
tileY=tileY>0?tileY%this.height:((tileY+1)%this.height)+this.height-1;}
for(var mapX=-1,pxX=pxMinX;pxX<pxMaxX;mapX++,pxX+=this.tilesize){var tileX=mapX+tileOffsetX;if(tileX>=this.width||tileX<0){if(!this.repeat){continue;}
tileX=tileX>0?tileX%this.width:((tileX+1)%this.width)+this.width-1;}
if((tile=this.data[tileY][tileX])){if((anim=this.anims[tile-1])){anim.draw(pxX,pxY);}
else{this.tiles.drawTile(pxX,pxY,tile-1,this.tilesize);}}}}}});});

// lib/impact/game.js
ig.baked=true;ig.module('impact.game').requires('impact.impact','impact.entity','impact.collision-map','impact.background-map').defines(function(){"use strict";ig.Game=ig.Class.extend({clearColor:'#000000',gravity:0,screen:{x:0,y:0},_rscreen:{x:0,y:0},entities:[],namedEntities:{},collisionMap:ig.CollisionMap.staticNoCollision,backgroundMaps:[],backgroundAnims:{},autoSort:false,sortBy:null,cellSize:64,_deferredKill:[],_levelToLoad:null,_doSortEntities:false,staticInstantiate:function(){this.sortBy=this.sortBy||ig.Game.SORT.Z_INDEX;ig.game=this;return null;},loadLevel:function(data){this.screen={x:0,y:0};this.entities=[];this.namedEntities={};for(var i=0;i<data.entities.length;i++){var ent=data.entities[i];this.spawnEntity(ent.type,ent.x,ent.y,ent.settings);}
this.sortEntities();this.collisionMap=ig.CollisionMap.staticNoCollision;this.backgroundMaps=[];for(var i=0;i<data.layer.length;i++){var ld=data.layer[i];if(ld.name=='collision'){this.collisionMap=new ig.CollisionMap(ld.tilesize,ld.data);}
else{var newMap=new ig.BackgroundMap(ld.tilesize,ld.data,ld.tilesetName);newMap.anims=this.backgroundAnims[ld.tilesetName]||{};newMap.repeat=ld.repeat;newMap.distance=ld.distance;newMap.foreground=!!ld.foreground;newMap.preRender=!!ld.preRender;newMap.name=ld.name;this.backgroundMaps.push(newMap);}}
for(var i=0;i<this.entities.length;i++){this.entities[i].ready();}},loadLevelDeferred:function(data){this._levelToLoad=data;},getMapByName:function(name){if(name=='collision'){return this.collisionMap;}
for(var i=0;i<this.backgroundMaps.length;i++){if(this.backgroundMaps[i].name==name){return this.backgroundMaps[i];}}
return null;},getEntityByName:function(name){return this.namedEntities[name];},getEntitiesByType:function(type){var entityClass=typeof(type)==='string'?ig.global[type]:type;var a=[];for(var i=0;i<this.entities.length;i++){var ent=this.entities[i];if(ent instanceof entityClass&&!ent._killed){a.push(ent);}}
return a;},spawnEntity:function(type,x,y,settings){var entityClass=typeof(type)==='string'?ig.global[type]:type;if(!entityClass){throw("Can't spawn entity of type "+type);}
var ent=new(entityClass)(x,y,settings||{});this.entities.push(ent);if(ent.name){this.namedEntities[ent.name]=ent;}
return ent;},sortEntities:function(){this.entities.sort(this.sortBy);},sortEntitiesDeferred:function(){this._doSortEntities=true;},removeEntity:function(ent){if(ent.name){delete this.namedEntities[ent.name];}
ent._killed=true;ent.type=ig.Entity.TYPE.NONE;ent.checkAgainst=ig.Entity.TYPE.NONE;ent.collides=ig.Entity.COLLIDES.NEVER;this._deferredKill.push(ent);},run:function(){this.update();this.draw();},update:function(){if(this._levelToLoad){this.loadLevel(this._levelToLoad);this._levelToLoad=null;}
if(this._doSortEntities||this.autoSort){this.sortEntities();this._doSortEntities=false;}
this.updateEntities();this.checkEntities();for(var i=0;i<this._deferredKill.length;i++){this.entities.erase(this._deferredKill[i]);}
this._deferredKill=[];for(var tileset in this.backgroundAnims){var anims=this.backgroundAnims[tileset];for(var a in anims){anims[a].update();}}},updateEntities:function(){for(var i=0;i<this.entities.length;i++){var ent=this.entities[i];if(!ent._killed){ent.update();}}},draw:function(){if(this.clearColor){ig.system.clear(this.clearColor);}
this._rscreen.x=ig.system.getDrawPos(this.screen.x)/ig.system.scale;this._rscreen.y=ig.system.getDrawPos(this.screen.y)/ig.system.scale;var mapIndex;for(mapIndex=0;mapIndex<this.backgroundMaps.length;mapIndex++){var map=this.backgroundMaps[mapIndex];if(map.foreground){break;}
map.setScreenPos(this.screen.x,this.screen.y);map.draw();}
this.drawEntities();for(mapIndex;mapIndex<this.backgroundMaps.length;mapIndex++){var map=this.backgroundMaps[mapIndex];map.setScreenPos(this.screen.x,this.screen.y);map.draw();}},drawEntities:function(){for(var i=0;i<this.entities.length;i++){this.entities[i].draw();}},checkEntities:function(){var hash={};for(var e=0;e<this.entities.length;e++){var entity=this.entities[e];if(entity.type==ig.Entity.TYPE.NONE&&entity.checkAgainst==ig.Entity.TYPE.NONE&&entity.collides==ig.Entity.COLLIDES.NEVER){continue;}
var checked={},xmin=Math.floor(entity.pos.x/this.cellSize),ymin=Math.floor(entity.pos.y/this.cellSize),xmax=Math.floor((entity.pos.x+entity.size.x)/this.cellSize)+1,ymax=Math.floor((entity.pos.y+entity.size.y)/this.cellSize)+1;for(var x=xmin;x<xmax;x++){for(var y=ymin;y<ymax;y++){if(!hash[x]){hash[x]={};hash[x][y]=[entity];}
else if(!hash[x][y]){hash[x][y]=[entity];}
else{var cell=hash[x][y];for(var c=0;c<cell.length;c++){if(entity.touches(cell[c])&&!checked[cell[c].id]){checked[cell[c].id]=true;ig.Entity.checkPair(entity,cell[c]);}}
cell.push(entity);}}}}}});ig.Game.SORT={Z_INDEX:function(a,b){return a.zIndex-b.zIndex;},POS_X:function(a,b){return(a.pos.x+a.size.x)-(b.pos.x+b.size.x);},POS_Y:function(a,b){return(a.pos.y+a.size.y)-(b.pos.y+b.size.y);}};});

// lib/plugins/empika/game_utilities.js
ig.baked=true;ig.module('plugins.empika.game_utilities').requires('impact.game').defines(function(){ig.Game.inject({entitiesUnderMouse:function(){var mouse_x=ig.input.mouse.x
var mouse_y=ig.input.mouse.y;mouse_x*=ig.game.coordScale;mouse_y*=ig.game.coordScale;var entities=this.entities;var under_mouse=[];for(var x=0;x<entities.length;x=x+1){var entity=entities[x];var pos_x=entity.pos.x-entity.offset.x;var pos_y=entity.pos.y-entity.offset.y;if(pos_x<=mouse_x&&mouse_x<=pos_x+entity.size.x&&pos_y<=mouse_y&&mouse_y<=pos_y+entity.size.y){if(!entity.ignoreMouse)
{under_mouse.push(entity);}}}
return under_mouse;}});});

// lib/plugins/preloader.js
ig.baked=true;ig.module('plugins.preloader').requires('impact.loader').defines(function()
{ig.Preloader=ig.Loader.extend({backdrop:new ig.Image('media/ui/preloader.png'),draw:function()
{this._drawStatus+=(this.status-this._drawStatus)/5;var s=ig.system.scale;var w=497;var h=15;var x=234;var y=482;ig.system.context.fillStyle='#DAECF6';ig.system.context.fillRect(0,0,960,640);this.backdrop.draw(0,0);ig.system.context.fillStyle='#2FA23D';ig.system.context.fillRect(x*s,y*s,w*s*this._drawStatus,h*s);}});});

// lib/game/facebook.js
ig.baked=true;ig.module('game.facebook').requires('impact.game').defines(function()
{Facebook=ig.Class.extend({scope:'publish_stream,email',init:function()
{},auth:function()
{var t=this;FB.login(function(response)
{if(response.authResponse)
{ig.game.fbid=response.authResponse.userID;t.getEmail();ig.game.screenManager.launchGame(true);}
else
{ig.game.screenManager.switchScreen('title');}},{scope:this.scope});return false;},invite:function()
{FB.ui({method:'apprequests',message:'If you thought looking after plants was easy, think again! This fast-paced game of skill will challenge your reactions and give even the greenest of fingers a tough workout!',});},getEmail:function()
{FB.api('/'+ig.game.fbid,function(response)
{ig.game.fbEmail=response.email});},post:function()
{var imageURL=document.location.protocol+'//social.tamba.co.uk/koubachi/game/images/fb-post.jpg';FB.ui({method:'feed',name:'Koubachi Game',link:'http://apps.facebook.com/koubachigame',picture:imageURL,caption:'{*actor*} has scored '+State.score+' points on the Koubachi game!',description:'Click the link (or the picture!) to try and beat their score and maybe you could win a voucher!'},function(response){});return false;}});});

// lib/game/grid.js
ig.baked=true;ig.module('game.grid').defines(function(){Grid=ig.Class.extend({bounds:[44,182,880,440],size:[8,4],maxHeat:0.5,coordToPixels:function(gx,gy)
{var squareSize=this.squareSize();var halfSquareSize=squareSize*.5;var xPos=(squareSize*gx)+this.bounds[0];var yPos=(squareSize*gy)+this.bounds[1];return{x:xPos+halfSquareSize,y:yPos+halfSquareSize}},pixelsToCoord:function(px,py)
{px-=this.bounds[0];py-=this.bounds[1];var squareSize=this.squareSize();var xPos=Math.floor(px/squareSize);var yPos=Math.floor(py/squareSize);if(xPos<0)xPos=0;else if(xPos>this.size[0]-1)xPos=this.size[0]-1;if(yPos<0)yPos=0;else if(yPos>this.size[1]-1)yPos=this.size[1]-1;return{x:xPos,y:yPos}},coordIsOccupied:function(gx,gy,excludedEntity)
{var entities=ig.game.entities;for(var i=0;i<entities.length;i++)
{var entity=entities[i]
var gridPos=entity.gridPos;if(gridPos)
{var toCheck=true;if(excludedEntity&&entity==excludedEntity)
{toCheck=false;}
if(toCheck&&gridPos.x==gx&&gridPos.y==gy)
{return true;}}}
return false},getRandomFreeCoord:function()
{var freeCoords=[];for(var gy=0;gy<this.size[1];gy++)
{for(var gx=0;gx<this.size[0];gx++)
{if(!this.coordIsOccupied(gx,gy))
{freeCoords.push({x:gx,y:gy});}}}
var r=Math.floor(Math.random()*freeCoords.length);return freeCoords[r];},squareSize:function()
{return this.bounds[2]/this.size[0];},getHeatLevel:function(gx,gy)
{var index=this.size[0]-gx;var heat=index*.125;return heat},getLightLevel:function(gx,gy)
{var light=0;if(gx<=3)
{if(gy==0)light=.8;else if(gy==1)light=.6;else if(gy==2)light=.4;else if(gy==3)light=.4;}
else
{if(gy==0)light=.4;else if(gy==1)light=.4;else if(gy==2)light=.8;else if(gy==3)light=1;}
return light;}});})

// lib/game/hud.js
ig.baked=true;ig.module('game.hud').requires('impact.entity','impact.font').defines(function()
{HUD=ig.Entity.extend({timerSeconds:0,timer:new ig.Timer(),timerActive:false,underlay:new ig.Image('media/hud/underlay.png'),mainFont:new ig.Font('media/fonts/arial-rounded-40.png'),init:function(x,y,settings)
{this.parent(x,y,settings);},toggleTimer:function(active)
{this.timer.set(this.maxSeconds)
this.timerActive=active;},updateTimer:function()
{if(this.timerActive)
{var lastTimerSeconds=this.timerSeconds;this.timerSeconds=Math.round(this.timer.delta());if(this.timerSeconds>lastTimerSeconds&&this.timerSeconds%5==0)
{ig.game.updateScore();}}},zeroFill:function(number,width)
{width-=number.toString().length;if(width>0)
{return new Array(width+(/\./.test(number)?2:1)).join('0')+number;}
return number+"";},update:function()
{this.parent();this.updateTimer();},draw:function()
{this.parent();this.underlay.draw(0,0);var textY=72;var mins=Math.floor((this.timerSeconds)/60);var secs=this.timerSeconds%60;var timerText=this.zeroFill(mins,2)+':'+this.zeroFill(secs,2);this.mainFont.draw(timerText,337,textY,ig.Font.ALIGN.LEFT);this.mainFont.draw(this.zeroFill(State.score,6),150,textY,ig.Font.ALIGN.LEFT);this.mainFont.draw('x'+State.lives,113,textY+5,ig.Font.ALIGN.RIGHT);},});})

// lib/game/screens/basescreen.js
ig.baked=true;ig.module('game.screens.basescreen').requires('impact.game','game.facebook').defines(function()
{BaseScreen=ig.Class.extend({id:'base',content:'',holder:null,holderID:'screens',classVar:'screen',gamePostURL:'http://game.koubachi.com/post.php',fbPostURL:'//social.tamba.co.uk/koubachi/game/post.php',postURL:'',postResponse:{},mediaPath:'media/ui',player:null,bookmarkURL:'http://www.tamba-games.co.uk/bookmarks.php',bookmarkClient:'koubachi',init:function()
{if(_facebook)this.postURL=this.fbPostURL;else this.postURL=this.gamePostURL;this.holder=$('#'+this.holderID);var html='<div id="screen-'+this.id+'" class="screen">'+this.content+'</div>';this.holder.empty();this.holder.append(html);},switchScreen:function(screenID)
{return'ig.game.screenManager.switchScreen(\''+screenID+'\'); return false;';},onPlayClicked:function()
{if(_facebook==1)
{if(ig.game.fbid=='')
{ig.game.facebook.auth();return false;}
else
{ig.game.screenManager.launchGame();}}
else
{ig.game.screenManager.launchGame();}},playVideo:function()
{ig.game.screenManager.switchScreen('video');$('#video').html('<a href="#" onclick="'+this.func('onVideoComplete',null,false)+'" id="skip-intro">Skip video</a><video src="video/intro.mp4" width="960" height="640"></video>');var t=this;ig.game.introPlaying=true;$('audio,video').mediaelementplayer({success:function(player,node){setTimeout(function(thisO){thisO.eventClickTrigger()},1000,t);t.setVideoPlayer(player);if(ig.music.volume<=0)
{player.setVolume(0);}
player.addEventListener('ended',function(e){t.onVideoComplete();});}});return false;},eventClickTrigger:function()
{$('.mejs-overlay-button').trigger('click');},setVideoPlayer:function(player)
{this.player=player;},stopVideo:function()
{$('#video').empty();ig.game.introPlaying=false;},onVideoComplete:function()
{this.stopVideo();ig.game.screenManager.switchScreen('game');},showMessage:function(message)
{var mHolder=$('#message');if(mHolder.length<=0)
{mHolder=this.holder.append('<div id="message"><div class="inner"></div></div>');mHolder=$('#message');mInner=$('#message .inner');mHolder.css('display','none');mHolder.fadeIn();}
mInner.html(message);},post:function(task,params,callbackName)
{this.postResponse={};var t=this;params['task']=task;$.post(this.postURL,params,function(response)
{if(callbackName)
{t.postResponse=response;eval('t.'+callbackName+'()');}});},func:function(method,arguments,useParent)
{var func='ig.game.screenManager.';if(!useParent)func+=this.classVar+'.';func+=method+'(';if(arguments)
{var j=arguments.length-1;for(var i=0;i<=j;i++)
{func+="'"+arguments[i]+"'";if(i<j)func+=',';}}
func+='); return false;';return func;},zeroFill:function(number,width)
{width-=number.toString().length;if(width>0)
{return new Array(width+(/\./.test(number)?2:1)).join('0')+number;}
return number+"";},validateString:function(input)
{return input.length>=1;},validateEmail:function(email)
{var regexp=eval("new RegExp(/^\\w+([\\.-]?\\w+)*@\\w+([\\.-]?\\w+)*(\\.\\w{2,4})+$/)");return regexp.test(email);},validateInt:function(n)
{return n>0;},zeroFill:function(number,width)
{width-=number.toString().length;if(width>0)
{return new Array(width+(/\./.test(number)?2:1)).join('0')+number;}
return number+"";},update:function()
{},gotoSocial:function(networkID)
{ig.game.screenManager.track(networkID);if(_facebook==1&&networkID=='facebook')
{ig.game.facebook.invite();return false;}
var url=this.bookmarkURL+'?client='+this.bookmarkClient+'&bookmark='+networkID;window.open(url,'_blank');return true;},});});

// lib/game/screens/titlescreen.js
ig.baked=true;ig.module('game.screens.titlescreen').requires('game.screens.basescreen').defines(function()
{TitleScreen=BaseScreen.extend({id:'title',init:function()
{this.content=''+'<ul class="buttons">'+'<li><a href="#" class="button play" onclick="'+this.func('onPlayClicked',null,false)+'">Play Game</a></li>'+'<li><a href="#" class="button instruct" onclick="'+this.switchScreen('instruct')+'">Instructions</a></li>'+'<li><a href="#" class="button leaderboard" onclick="'+this.switchScreen('leaderboard')+'">Leaderboard</a></li>'+'</ul><a href="#" id="title-terms" onclick="'+this.switchScreen('terms')+'">Terms and Conditions</a>';this.parent();}});});

// lib/game/screens/instructions.js
ig.baked=true;ig.module('game.screens.instructions').requires('game.screens.basescreen').defines(function()
{Instructions=BaseScreen.extend({id:'instruct',index:0,maxIndex:4,init:function()
{this.content=''+'<ul class="instruct-nav">'+'<li><a href="#" class="button prev" onclick="'+this.func('onPrevClicked',null,false)+'"></a></li>'+'<li><a href="#" class="button next" onclick="'+this.func('onNextClicked',null,false)+'"></a></li>'+'</ul>'+'<ul id="instruct-holder">'+'<li id="instruct-0">Screen 1</li>'+'<li id="instruct-1">Screen 2</li>'+'<li id="instruct-2">Screen 3</li>'+'<li id="instruct-3">Screen 4</li>'+'<li id="instruct-4">Screen 5</li>'+'</ul><div id="instruct-page">1/'+(this.maxIndex+1)+'</div>'+'<ul class="screen-footer">'+'<li><a href="#" class="button play-small left" onclick="'+this.func('onPlayClicked',null,false)+'"></a></li>'+'</ul>';this.parent();$('#instruct-holder li').css('display','none');$('#instruct-0').css('display','block');},showScreen:function()
{var currentID='instruct-'+this.index;var fadeDuration=250;$('#instruct-holder li').each(function()
{var id=$(this).attr('id');if(id==currentID)
{$(this).fadeIn(fadeDuration);}
else
{$(this).fadeOut(fadeDuration);}});$('#instruct-page').text((this.index+1)+'/'+(this.maxIndex+1))},onPrevClicked:function()
{this.index--;if(this.index<0)this.index=this.maxIndex;this.showScreen();},onNextClicked:function()
{this.index++;if(this.index>this.maxIndex)this.index=0;this.showScreen();}});});

// lib/game/screens/leaderboard.js
ig.baked=true;ig.module('game.screens.leaderboard').requires('game.screens.basescreen').defines(function()
{Leaderboard=BaseScreen.extend({id:'scores',init:function()
{this.content='<div id="scores-loading"></div>'+'<div id="scrollbar"><div class="scrollbar"><div class="track"><div class="thumb"><div class="end"></div></div></div></div>'+'<div class="viewport"><div id="scores" class="overview"></div>'+'</div></div>'+'<ul class="screen-footer">'+'<li><a href="#" class="button play-small left" onclick="'+this.func('onPlayClicked',null,false)+'"></a></li>'+'</ul>';this.parent();this.getHighScores();},getHighScores:function()
{this.post('getscores',{facebook:_facebook},'onScoresRetrieved');},onScoresRetrieved:function()
{$('#scores-loading').css('display','none');var holder=$('#scores');var data=this.postResponse;if(data.length>100)return;var j=data.length;for(var i=0;i<j;i++)
{var row='<div class="row"><div class="name noselect">'+data[i].username+'</div> <div class="score noselect">'+data[i].points+'</div></div>'
holder.append(row);}
$('#scrollbar').tinyscrollbar({sizethumb:49});}});});

// lib/game/screens/submitscore.js
ig.baked=true;ig.module('game.screens.submitscore').requires('game.screens.basescreen').defines(function()
{SubmitScore=BaseScreen.extend({id:'submitscore',canSubmit:true,voucherScore:1000,salt:'kCamcRNNxZ',init:function()
{var score=State.score;this.content='<div id="score-title">MY SCORE: '+score+'</div><div id="score-message"></div>'+'<div class="error" id="error-yourname"></div>'+'<div class="error" id="error-youremail"></div>'+'<ul id="score-buttons">'+'<li><a href="#" class="btn2" onclick="'+this.func('submitScore',null,false)+'"></a></li>'+'<li><a href="#" class="btn1" onclick="'+this.switchScreen('game')+'"></a></li>'+'</ul>'+'<ul id="score-social">'+'<li><a href="#" class="facebook" onclick="'+this.func('gotoSocial',['facebook'])+'">Facebook</a></li>'+'<li><a href="#" class="twitter" onclick="'+this.func('gotoSocial',['twitter'])+'">Twitter</a></li>'+'</ul>'+'<input type="text" class="input left" id="yourname" maxlength="30" value="" />'+'<input type="text" class="input right" id="youremail" maxlength="100" value="'+ig.game.fbEmail+'" />';this.parent();if(score>=this.voucherScore)
{$('#score-message').addClass('active');$('#score-buttons .btn1').addClass('win');$('#score-buttons .btn2').addClass('win');ig.game.gameWin=true;}
else
{$('#score-buttons .btn1').addClass('lose');$('#score-buttons .btn2').addClass('lose');ig.game.gameWin=false;}},submitScore:function()
{if(!this.canSubmit)return false;var name=jQuery.trim($('#yourname').val());var email=jQuery.trim($('#youremail').val());$('#error-yourname').removeClass('active');$('#error-youremail').removeClass('active');if(!this.validateString(name))
{$('#error-yourname').addClass('active');}
else if(!this.validateEmail(email))
{$('#error-youremail').addClass('active')}
else
{this.postScore();}
return false;},postScore:function()
{this.canSubmit=false;this.showMessage('Please wait...');var name=jQuery.trim($('#yourname').val());var email=jQuery.trim($('#youremail').val());var hash=hex_md5('client='+this.salt+'&username='+name+'&email='+email+'&score='+State.score);this.post('setscore',{name:name,email:email,score:State.score,fbid:ig.game.fbid,hash:hash},'onScoreSubmitComplete');},onScoreSubmitComplete:function()
{if(_facebook)
{ig.game.facebook.post()}
ig.game.screenManager.switchScreen('endgame');}});});

// lib/game/screens/sendfriend.js
ig.baked=true;ig.module('game.screens.sendfriend').requires('game.screens.basescreen').defines(function()
{SendFriend=BaseScreen.extend({id:'sendfriend',maxFriends:3,canSubmit:true,init:function()
{var html='<div class="content">'+'<div class="formrow" id="you"><input type="text" class="input left" id="yourname" maxlength="30" value="" />'+'<input type="text" class="input right" id="youremail" maxlength="100" value="" /></div><div class="friends">'+'<ul class="screen-footer">'+'<li><a href="#" class="button friendsubmit left" onclick="'+this.func('submitSendFriend',null,false)+'"></a></li>'+'<li><a href="#" class="button friendback left" onclick="'+this.switchScreen('endgame')+'"></a></li>'+'</ul>';for(var i=1;i<=this.maxFriends;i++)
{html+='<div class="formrow" id="friend-'+i+'"><input type="text" class="input left" id="friendname_'+i+'" value="" maxlength="30" /><input type="text" class="input right" id="friendemail_'+i+'" value="" maxlength="100" /></div>';}
html+='</div></div>';this.content=html;this.parent();},submitSendFriend:function()
{if(!this.canSubmit)return false;this.resetErrors();var senderName=jQuery.trim($('#yourname').val());var senderEmail=jQuery.trim($('#youremail').val());if(!this.validateString(senderName))
{$('#you').addClass('active');}
else if(!this.validateEmail(senderEmail))
{$('#you').addClass('active');}
else if(this.validateFriends())
{this.sendToFriends();}
return false;},validateFriends:function()
{var totalFriends=0;for(var i=1;i<=this.maxFriends;i++)
{var name=jQuery.trim($('#friendname_'+i).val());var email=jQuery.trim($('#friendemail_'+i).val());if(name||email)
{if(!this.validateString(name))
{$('#friend-'+i).addClass('active');return false;}
else if(!this.validateEmail(email))
{$('#friend-'+i).addClass('active');return false;}
totalFriends++;}}
if(totalFriends<=0)
{for(var i=1;i<=this.maxFriends;i++)
{$('#friend-'+i).addClass('active')}
return false;}
return true;},sendToFriends:function()
{this.showMessage('Please wait...');var senderName=jQuery.trim($('#yourname').val());var senderEmail=jQuery.trim($('#youremail').val());this.canSubmit=false;for(var i=1;i<=this.maxFriends;i++)
{var recipientName=jQuery.trim($('#friendname_'+i).val());var recipientEmail=jQuery.trim($('#friendemail_'+i).val());var params={sender_name:senderName,sender_email:senderEmail,recipient_name:recipientName,recipient_email:recipientEmail};this.post('sendfriend',params);}
this.onSendComplete();},onSendComplete:function()
{this.canSubmit=true;this.showMessage('Emails sent! Send more?');this.resetForm();},resetForm:function()
{for(var i=1;i<=this.maxFriends;i++)
{$('#friendname_'+i).val('');$('#friendemail_'+i).val('');}
this.resetErrors();},resetErrors:function()
{$('#you').removeClass('active');for(var i=1;i<=this.maxFriends;i++)
{$('#friend-'+i).removeClass('active')}}});});

// lib/game/screens/endgame.js
ig.baked=true;ig.module('game.screens.endgame').requires('game.screens.basescreen').defines(function()
{EndGame=BaseScreen.extend({id:'endgame',voucherLink:'http://store.koubachi.com/products/m9ur7zJkFw6Q9RB2tXRw',init:function()
{var content='';if(ig.game.gameWin)
{content+='<a href="'+this.voucherLink+'" target="_blank" id="voucher" class="button">Claim my prize</a>';}
content+=''+'<ul id="endgame-buttons">'+'<li><a href="#" class="button tell-more" onclick="'+this.func('gotoClient',null,false)+'">Tell me more</a></li>'+'<li><a href="#" class="button play-again" onclick="'+this.switchScreen('game')+'">Play again</a></li>'+'<li><a href="#" class="button send-friend" onclick="'+this.switchScreen('sendfriend')+'">Send to friends</a></li>'+'<li><a href="#" class="button leaderboard end" onclick="'+this.switchScreen('leaderboard')+'">Leaderboard</a></li>'+'</ul>';this.content=content;this.parent();if(ig.game.gameWin)
{$('#screen-endgame').addClass('win');}},gotoClient:function()
{window.open('http://www.koubachi.com','_blank');return false;}});});

// lib/game/screens/terms.js
ig.baked=true;ig.module('game.screens.terms').requires('game.screens.basescreen').defines(function()
{Terms=BaseScreen.extend({id:'terms',init:function()
{this.content=''+'<div id="scrollbar"><div class="scrollbar"><div class="track"><div class="thumb"><div class="end"></div></div></div></div>'+'<div class="viewport"><div id="terms" class="overview">'+'<ol>'+'<li>Koubachi and associated competition are owned, run and promoted by Koubachi, registered in Switzerland (no.Koubachi). Registered office is Koubachi.</li>'+'<li>Koubachi shall at all times retain all copyright and intellectual property in the game. </li>'+'<li>Participants use the game at their own risk. Whilst Koubachi seeks to ensure that the game is defect and virus free, it accepts no liability whatsoever for any damage to any Participant\'s computer hardware, software or network system. </li>'+'<li>All participants who wish to be entered into the competition to win a prize must play the game and then enter their score onto the leader board. </li>'+'<li>A voucher to buy the Koubachi Wi-Fi Plant Sensor Indoor with a substantial discount will be given to players scoring a certain number of points.</li>'+'<li>Koubachi reserves the right to change the high score that is required to win a voucher.  </li>'+'<li>Koubachi may only provide vouchers for Koubachi Wi-Fi Plant Sensor Indoor while stocks last.</li>'+'<li>Koubachi reserves the right to substitute alternative prizes. </li>'+'<li>All participants who enter a score and their e-mail address onto the leader board will be entered into a prize draw to win a Koubachi Wi-Fi Plant Sensor free of cost. Prizes will be drawn once every month.</li>'+'<li>The winning participant shall be notified within 24 hours via email.</li>'+'<li>In the event that the winning participants do not make contact with Koubachi within 2 weeks of the winning email being sent, their prize will be forfeit.</li>'+'<li>Any participant who attempts to falsify their score or unfairly manipulate the game in any way will automatically be disqualified and shall not be eligible for any prize. </li>'+'<li>Koubachi decision in all matters relating to the competition and game shall be final. </li>'+'<li>The competition shall remain open until 31st March 2013. Any scores entered after this date shall be disregarded. </li>'+'<li>The winning participant\'s name may be published for marketing and promotional purposes. </li>'+'<li>Koubachi agree not to pass on personal details captured by the game to any third parties. </li>'+'<li>By entering the competition you agree to Koubachi collecting your details for the purposes of sending you future mailings. Any participant who subsequently wishes to stop receiving such mailings can do so by sending an email to <a href="mailto:support@koubachi.com">support@koubachi.com</a>.</li>'+'</ol><p>These terms and conditions and the competition to which they relate shall be governed and construed in accordance with the laws of Switzerland and shall be subject to the exclusive jurisdiction of the courts in Zurich, Switzerland.</p>'+'</div>'+'</div></div>'+'<ul class="screen-footer">'+'<li><a href="#" class="button back left" onclick="'+this.switchScreen('title')+'"></a></li>'+'</ul>';this.parent();$('#scrollbar').tinyscrollbar({sizethumb:49});}});});

// lib/game/screens/intro.js
ig.baked=true;ig.module('game.screens.intro').requires('game.screens.basescreen').defines(function()
{Intro=BaseScreen.extend({id:'intro',player:null,init:function()
{this.content='<div id="intro-loading"></div>';this.parent();}});});

// lib/game/screens/game.js
ig.baked=true;ig.module('game.screens.game').requires('game.screens.basescreen').defines(function()
{GameScreen=BaseScreen.extend({id:'game',init:function()
{this.content='';this.parent();},});});

// lib/game/screenmanager.js
ig.baked=true;ig.module('game.screenmanager').requires('impact.game','game.screens.titlescreen','game.screens.instructions','game.screens.leaderboard','game.screens.submitscore','game.screens.sendfriend','game.screens.endgame','game.screens.terms','game.screens.intro','game.screens.game').defines(function()
{ScreenManager=ig.Class.extend({idTable:{'title':'TitleScreen','instruct':'Instructions','leaderboard':'Leaderboard','sendfriend':'SendFriend','submitscore':'SubmitScore','game':'GameScreen','terms':'Terms','video':'Intro','endgame':'EndGame'},showSocialOn:['instruct','leaderboard','sendfriend'],showSoundOn:['title','game'],screen:null,screenID:'',screenCount:0,transitionsLocked:false,backdrop:new ig.Image('media/ui/bg.jpg'),init:function(screenID)
{this.clearColor=null;this.switchScreen(screenID);},switchScreen:function(screenID)
{if(screenID==this.screenID)return false;if(_facebook==1)
{if(screenID=='sendfriend')
{ig.game.facebook.invite();return false;}}
if(!this.transitionsLocked)
{this.screenID=screenID;if(this.screen)
{this.removeScreen();}
else
{this.addScreen();}}
return true;},addScreen:function()
{var p=this;if(this.idTable[this.screenID])
{for(var i=0;i<this.showSocialOn.length;i++)
{if(this.showSocialOn[i]!=this.screenID)
{ig.game.toggleSocial(false);}
else
{ig.game.toggleSocial(true);break;}}
this.screen=eval('new '+this.idTable[this.screenID]+'()');if(this.screenCount>0)
{this.track(this.idTable[this.screenID]);$('#'+this.screen.holderID).animate({width:'960px'},{duration:250,complete:function()
{p.transitionsLocked=false;}});}
this.screenCount++;}},removeScreen:function()
{if(this.screenID=='game')
{this.startGame();}
this.transitionsLocked=true;var p=this;$('#'+this.screen.holderID).animate({width:'0px'},{duration:250,complete:function()
{p.addScreen();}});},initGame:function()
{ig.game.initGame();},startGame:function()
{ig.game.initGame();},launchGame:function()
{if(ig.game.skipIntro)
{this.switchScreen('game');}
else
{this.switchScreen('video');this.screen.playVideo();ig.game.skipIntro=true;}},track:function(id)
{if(_gaq)
{_gaq.push(['_trackEvent','game','userAction',id]);}},update:function()
{if(this.screen)
{this.screen.update();}},draw:function()
{this.backdrop.draw(0,0)}});});

// lib/game/screens/footer.js
ig.baked=true;ig.module('game.screens.footer').requires('game.screens.basescreen').defines(function()
{Footer=BaseScreen.extend({id:'footer',holderID:'footer',classVar:'footer',init:function()
{this.content=''+'<ul class="footer">'+'<li><a href="#" class="sound" id="btn-sound" onclick="'+this.func('toggleSound')+'">Sound on/off</a></li>'+'<li><a href="http://www.tamba.co.uk" class="tamba" target="_blank" id="btntamba">Game by TAMBA</a></li>'+'</ul>';this.parent();},hide:function()
{$('#'+this.holderID).css('display','none');},show:function()
{$('#'+this.holderID).css('display','block');},func:function(method,arguments,useParent)
{var func='ig.game.footer.';func+=method+'(';if(arguments)
{var j=arguments.length-1;for(var i=0;i<=j;i++)
{func+="'"+arguments[i]+"'";if(i<j)func+=',';}}
func+='); return false;';return func;}});});

// lib/game/screens/social.js
ig.baked=true;ig.module('game.screens.social').requires('game.screens.basescreen').defines(function()
{Social=BaseScreen.extend({id:'social',holderID:'social',classVar:'social',init:function()
{this.content=''+'<ul class="social">'+'<li><a href="#" class="social facebook" onclick="'+this.func('gotoSocial',['facebook'])+'">Facebook</a></li>'+'<li><a href="#" class="social twitter" onclick="'+this.func('gotoSocial',['twitter'])+'">Twitter</a></li>'+'</ul>';this.parent();},hide:function()
{$('#'+this.holderID).css('display','none');},show:function()
{$('#'+this.holderID).css('display','block');},func:function(method,arguments,useParent)
{var func='ig.game.social.';func+=method+'(';if(arguments)
{var j=arguments.length-1;for(var i=0;i<=j;i++)
{func+="'"+arguments[i]+"'";if(i<j)func+=',';}}
func+='); return false;';return func;}});});

// lib/game/screens/sound.js
ig.baked=true;ig.module('game.screens.sound').requires('game.screens.basescreen').defines(function()
{SoundManager=BaseScreen.extend({id:'sound',holderID:'soundmanager',classVar:'sound',bookmarkURL:'http://www.tamba-games.co.uk/bookmarks.php',bookmarkClient:'koubachi',init:function()
{this.content=''+'<a href="#" onclick="'+this.func('toggleSound',null,false)+'" id="btnsound">Toggle sound</a>';this.parent();},toggleSound:function()
{if(ig.music.volume>0)
{ig.Sound.enabled=false;ig.music.volume=0;$('#btnsound').css('background-position','0 -26px');}
else
{ig.Sound.enabled=true;ig.music.volume=1;$('#btnsound').css('background-position','0 0');}},hide:function()
{$('#'+this.holderID).css('display','none');},show:function()
{$('#'+this.holderID).css('display','block');},func:function(method,arguments,useParent)
{var func='ig.game.sound.';func+=method+'(';if(arguments)
{var j=arguments.length-1;for(var i=0;i<=j;i++)
{func+="'"+arguments[i]+"'";if(i<j)func+=',';}}
func+='); return false;';return func;}});});

// lib/plugins/impact-tween/entity.js
ig.baked=true;ig.module('plugins.impact-tween.entity').requires('impact.entity').defines(function(){if(!Array.prototype.indexOf){Array.prototype.indexOf=function(el,start){var start=start||0;for(var i=0;i<this.length;++i){if(this[i]===el){return i;}}
return-1;};}
ig.Entity.inject({tweens:[],update:function(){var t=this.tweens.length;this.parent();if(this.tweens.length>0){var currentTweens=[];for(var i=0;i<this.tweens.length;i++){this.tweens[i].update();if(!this.tweens[i].complete)currentTweens.push(this.tweens[i]);}
this.tweens=currentTweens;}},tween:function(props,duration,settings){var tween=new ig.Tween(this,props,duration,settings);this.tweens.push(tween);return tween;},pauseTweens:function(){for(var i=0;i<this.tweens.length;i++){this.tweens[i].pause();}},resumeTweens:function(){for(var i=0;i<this.tweens.length;i++){this.tweens[i].resume();}},stopTweens:function(doComplete){for(var i=0;i<this.tweens.length;i++){this.tweens[i].stop(doComplete);}}});});

// lib/plugins/impact-tween/tween.js
ig.baked=true;ig.module('plugins.impact-tween.tween').requires('plugins.impact-tween.entity').defines(function(){if(!Array.prototype.indexOf){Array.prototype.indexOf=function(el,start){var start=start||0;for(var i=0;i<this.length;++i){if(this[i]===el){return i;}}
return-1;};}
ig.Tween=ig.Class.extend({_objects:null,valuesStart:[],valuesEnd:[],valuesDelta:[],_elapsed:0,timer:false,started:false,_props:{},_chained:false,duration:0,complete:false,paused:false,easing:null,onComplete:false,delay:0,loop:0,loopCount:-1,loopNum:-1,init:function(obj,properties,duration,settings){this.easing=ig.Tween.Easing.Linear.EaseNone;this.duration=duration;ig.merge(this,settings);this.loopNum=this.loopCount;if(typeof properties=='object'&&properties.constructor===(new Array).constructor){this._props=properties;}else{this._props=[properties];}
if(typeof obj=='object'&&obj.constructor===(new Array).constructor){this._objects=obj;}else{this._objects=[obj];}
for(var i=0;i<this._objects.length;i++){this.valuesStart.push({});this.valuesEnd.push({});this.valuesDelta.push({});}},chain:function(chainObj){this._chained=chainObj;},initEnd:function(prop,from,to){if(typeof(from[prop])!=="object"){to[prop]=from[prop];}else{for(var subprop in from[prop]){if(!to[prop])to[prop]={};this.initEnd(subprop,from[prop],to[prop]);}}},initStart:function(prop,end,from,to){;if(typeof from.tweenInitStart==="function"){return from.tweenInitStart(prop,end,to);}
if(typeof(from[prop])!=="object"){if(typeof(end[prop])!=="undefined")to[prop]=from[prop];}else{for(var subprop in from[prop]){if(!to[prop])to[prop]={};if(typeof(end[prop])!=="undefined")this.initStart(subprop,end[prop],from[prop],to[prop]);}}},start:function(){this.complete=false;this.paused=false;this.loopNum=this.loopCount;this._elapsed=0;this.started=true;this.timer=new ig.Timer();for(var i=0;i<this._objects.length;i++){if(this._objects[i].tweens.indexOf(this)==-1){this._objects[i].tweens.push(this);}
for(var property in this._props[i]){this.initEnd(property,this._props[i],this.valuesEnd[i]);}
for(var property in this.valuesEnd[i]){this.initStart(property,this.valuesEnd[i],this._objects[i],this.valuesStart[i]);this.initDelta(property,this.valuesDelta[i],this._objects[i],this.valuesEnd[i]);}}},initDelta:function(prop,delta,start,end){if(typeof start.tweenInitDelta==="function"){return start.tweenInitDelta(prop,delta,end);}
if(typeof(end[prop])!=="object"){delta[prop]=end[prop]-start[prop];}else{for(var subprop in end[prop]){if(!delta[prop])delta[prop]={};this.initDelta(subprop,delta[prop],start[prop],end[prop]);}}},propUpdate:function(prop,obj,start,delta,value){if(typeof obj.tweenPropUpdate==="function"){return obj.tweenPropUpdate(prop,start,delta,value);}
if(typeof(start[prop])!=="object"){if(typeof start[prop]!="undefined"){obj[prop]=start[prop]+delta[prop]*value;}else{obj[prop]=obj[prop];}}else{for(var subprop in start[prop]){this.propUpdate(subprop,obj[prop],start[prop],delta[prop],value);}}},propSet:function(prop,from,to){if(typeof to.tweenPropSet==="function"){return to.tweenPropSet(prop,from);}
if(typeof(from[prop])!=="object"){to[prop]=from[prop];}else{for(subprop in from[prop]){if(!to[prop])to[prop]={};this.propSet(subprop,from[prop],to[prop]);}}},update:function(){if(!this.started)return false;if(this.delay){if(this.timer.delta()<this.delay)return;this.delay=0;this.timer.reset();}
if(this.paused||this.complete)return false;var elapsed=(this.timer.delta()+this._elapsed)/this.duration;elapsed=elapsed>1?1:elapsed;var value=this.easing(elapsed);for(var i=0;i<this._objects.length;i++){for(var property in this.valuesDelta[i]){this.propUpdate(property,this._objects[i],this.valuesStart[i],this.valuesDelta[i],value);}
if(elapsed>=1){if(this.loopNum==0||!this.loop){this.complete=true;if(this.onComplete)this.onComplete();if(this._chained)this._chained.start();return false;}else if(this.loop==ig.Tween.Loop.Revert){for(var property in this.valuesStart[i]){this.propSet(property,this.valuesStart[i],this._objects[i]);}
this._elapsed=0;this.timer.reset();if(this.loopNum!=-1)this.loopNum--;}else if(this.loop==ig.Tween.Loop.Reverse){var _start={},_end={},_delta={};ig.merge(_start,this.valuesEnd[i]);ig.merge(_end,this.valuesStart[i]);ig.merge(this.valuesStart[i],_start);ig.merge(this.valuesEnd[i],_end);for(var property in this.valuesEnd[i]){this.initDelta(property,this.valuesDelta[i],this._objects[i],this.valuesEnd[i]);}
this._elapsed=0;this.timer.reset();if(this.loopNum!=-1)this.loopNum--;}}}},pause:function(){this.paused=true;this._elapsed+=this.timer.delta();},resume:function(){this.paused=false;this.timer.reset();},stop:function(doComplete){if(doComplete){this.paused=false;this.complete=false;this.loop=false;this._elapsed+=this.duration;this.update();}
this.complete=true;},rewind:function(){var loop=this.loop;this.complete=false;this.paused=false;this.loopNum=-1;this.loop=ig.Tween.Loop.Revert;this.update();this.loop=loop;}});ig.Tween.Loop={Revert:1,Reverse:2};ig.Tween.Easing={Linear:{},Quadratic:{},Cubic:{},Quartic:{},Quintic:{},Sinusoidal:{},Exponential:{},Circular:{},Elastic:{},Back:{},Bounce:{}};ig.Tween.Easing.Linear.EaseNone=function(k){return k;};ig.Tween.Easing.Quadratic.EaseIn=function(k){return k*k;};ig.Tween.Easing.Quadratic.EaseOut=function(k){return-k*(k-2);};ig.Tween.Easing.Quadratic.EaseInOut=function(k){if((k*=2)<1)return 0.5*k*k;return-0.5*(--k*(k-2)-1);};ig.Tween.Easing.Cubic.EaseIn=function(k){return k*k*k;};ig.Tween.Easing.Cubic.EaseOut=function(k){return--k*k*k+1;};ig.Tween.Easing.Cubic.EaseInOut=function(k){if((k*=2)<1)return 0.5*k*k*k;return 0.5*((k-=2)*k*k+2);};ig.Tween.Easing.Quartic.EaseIn=function(k){return k*k*k*k;};ig.Tween.Easing.Quartic.EaseOut=function(k){return-(--k*k*k*k-1);}
ig.Tween.Easing.Quartic.EaseInOut=function(k){if((k*=2)<1)return 0.5*k*k*k*k;return-0.5*((k-=2)*k*k*k-2);};ig.Tween.Easing.Quintic.EaseIn=function(k){return k*k*k*k*k;};ig.Tween.Easing.Quintic.EaseOut=function(k){return(k=k-1)*k*k*k*k+1;};ig.Tween.Easing.Quintic.EaseInOut=function(k){if((k*=2)<1)return 0.5*k*k*k*k*k;return 0.5*((k-=2)*k*k*k*k+2);};ig.Tween.Easing.Sinusoidal.EaseIn=function(k){return-Math.cos(k*Math.PI/2)+1;};ig.Tween.Easing.Sinusoidal.EaseOut=function(k){return Math.sin(k*Math.PI/2);};ig.Tween.Easing.Sinusoidal.EaseInOut=function(k){return-0.5*(Math.cos(Math.PI*k)-1);};ig.Tween.Easing.Exponential.EaseIn=function(k){return k==0?0:Math.pow(2,10*(k-1));};ig.Tween.Easing.Exponential.EaseOut=function(k){return k==1?1:-Math.pow(2,-10*k)+1;};ig.Tween.Easing.Exponential.EaseInOut=function(k){if(k==0)return 0;if(k==1)return 1;if((k*=2)<1)return 0.5*Math.pow(2,10*(k-1));return 0.5*(-Math.pow(2,-10*(k-1))+2);};ig.Tween.Easing.Circular.EaseIn=function(k){return-(Math.sqrt(1-k*k)-1);};ig.Tween.Easing.Circular.EaseOut=function(k){return Math.sqrt(1-(--k)*k);};ig.Tween.Easing.Circular.EaseInOut=function(k){if((k/=0.5)<1)return-0.5*(Math.sqrt(1-k*k)-1);return 0.5*(Math.sqrt(1-(k-=2)*k)+1);};ig.Tween.Easing.Elastic.EaseIn=function(k){var s,a=0.1,p=0.4;if(k==0)return 0;if(k==1)return 1;if(!p)p=0.3;if(!a||a<1){a=1;s=p/4;}
else s=p/(2*Math.PI)*Math.asin(1/a);return-(a*Math.pow(2,10*(k-=1))*Math.sin((k-s)*(2*Math.PI)/p));};ig.Tween.Easing.Elastic.EaseOut=function(k){var s,a=0.1,p=0.4;if(k==0)return 0;if(k==1)return 1;if(!p)p=0.3;if(!a||a<1){a=1;s=p/4;}
else s=p/(2*Math.PI)*Math.asin(1/a);return(a*Math.pow(2,-10*k)*Math.sin((k-s)*(2*Math.PI)/p)+1);};ig.Tween.Easing.Elastic.EaseInOut=function(k){var s,a=0.1,p=0.4;if(k==0)return 0;if(k==1)return 1;if(!p)p=0.3;if(!a||a<1){a=1;s=p/4;}
else s=p/(2*Math.PI)*Math.asin(1/a);if((k*=2)<1)return-0.5*(a*Math.pow(2,10*(k-=1))*Math.sin((k-s)*(2*Math.PI)/p));return a*Math.pow(2,-10*(k-=1))*Math.sin((k-s)*(2*Math.PI)/p)*0.5+1;};ig.Tween.Easing.Back.EaseIn=function(k){var s=1.70158;return k*k*((s+1)*k-s);};ig.Tween.Easing.Back.EaseOut=function(k){var s=1.70158;return(k=k-1)*k*((s+1)*k+s)+1;};ig.Tween.Easing.Back.EaseInOut=function(k){var s=1.70158*1.525;if((k*=2)<1)return 0.5*(k*k*((s+1)*k-s));return 0.5*((k-=2)*k*((s+1)*k+s)+2);};ig.Tween.Easing.Bounce.EaseIn=function(k){return 1-ig.Tween.Easing.Bounce.EaseOut(1-k);};ig.Tween.Easing.Bounce.EaseOut=function(k){if((k/=1)<(1/2.75)){return 7.5625*k*k;}else if(k<(2/2.75)){return 7.5625*(k-=(1.5/2.75))*k+0.75;}else if(k<(2.5/2.75)){return 7.5625*(k-=(2.25/2.75))*k+0.9375;}else{return 7.5625*(k-=(2.625/2.75))*k+0.984375;}};ig.Tween.Easing.Bounce.EaseInOut=function(k){if(k<0.5)return ig.Tween.Easing.Bounce.EaseIn(k*2)*0.5;return ig.Tween.Easing.Bounce.EaseOut(k*2-1)*0.5+0.5;};});

// lib/plugins/fading.js
ig.baked=true;ig.module('plugins.fading').requires('impact.entity','impact.input').defines(function(){ig.Entity.inject({span:0,fadeValue:'stop',readyToKill:false,init:function(x,y,settings){this.parent(x,y,settings);if(this.fadeValue=='in'){this.currentAnim.alpha=0;}else if(this.fadeValue=='out'){this.currentAnim.alpha=1;}
this.timer=new ig.Timer(this.span);},update:function(){this.parent();if(this.fadeValue=='in'){this.fadeIn()}
if(this.fadeValue=='out'){this.fadeOut();}
if(this.fadeValue=='stop'&&this.readyToKill){this.kill();}},fadeIn:function(){if(this.timer.delta()<=0){this.currentAnim.alpha=1+(this.timer.delta()/this.span);}else{this.fadeValue='stop';}},fadeOut:function(){if(this.timer.delta()<=0){this.currentAnim.alpha=0-(this.timer.delta()/this.span);}else{this.fadeValue='stop';}},setFade:function(fadeValue,span,readyToKill){this.fadeValue=fadeValue;this.timer.set(span);this.readyToKill=readyToKill;},});});

// lib/game/entities/bases/base.js
ig.baked=true;ig.module('game.entities.bases.base').requires('impact.entity','plugins.impact-tween.tween','plugins.fading','game.grid').defines(function()
{EntityBase=ig.Entity.extend({_wmIgnore:false,collides:ig.Entity.COLLIDES.NONE,isClicked:false,isPlant:false,isTool:false,draggable:true,dragDistance:0,dragOrigin:{x:0,y:0},doubleClickTimer:null,checkForDoubleClick:true,ignoreMouse:false,grid:new Grid(),posDelta:{x:0,y:0},modX:{x:0,y:0},gridPos:{x:-1,y:-1},init:function(x,y,settings)
{this.doubleClickTimer=new ig.Timer(0.3);this.parent(x,y,settings);},addToGrid:function(gx,gy,correct)
{if(this.grid.coordIsOccupied(gx,gy,this))
{this.addToGrid(this.gridPos.x,this.gridPos.y,true);return;}
var pixelCoords=this.grid.coordToPixels(gx,gy);if(correct)
{this.tween({pos:{x:pixelCoords.x,y:pixelCoords.y}},.15,{easing:ig.Tween.Easing.Quadratic.EaseIn}).start();}
else
{this.pos.y=-this.size.y*2;this.pos.x=pixelCoords.x;var onComplete=function(){this.onLandedOnGrid()}.bind(this);this.tween({pos:{x:pixelCoords.x,y:pixelCoords.y}},.4,{easing:ig.Tween.Easing.Quadratic.EaseIn,onComplete:onComplete}).start();}
this.gridPos={x:gx,y:gy};this.zIndex=(gy-this.grid.size[1])*20;ig.game.sortEntitiesDeferred();},onLandedOnGrid:function()
{this.thudSound.play();},dragAndDrop:function()
{var mouse_x=ig.input.mouse.x;var mouse_y=ig.input.mouse.y;var modX=0;var mod_y=0;var isClicked=this.isClicked;if(isClicked&&ig.input.state('lbtn'))
{this.pos.x=mouse_x-this.posDelta.x;this.pos.y=mouse_y-this.posDelta.y;this.zIndex=999;ig.game.itemCarried=true;ig.game.sortEntitiesDeferred();}
else if(isClicked)
{this.isClicked=false;ig.game.itemCarried=false;var x2=this.pos.x;var x1=this.dragOrigin.x;var y2=this.pos.y;var y1=this.dragOrigin.y;var xd=x2-x1;var yd=y2-y1;this.dragDistance=Math.sqrt(xd*xd+yd*yd)
this.onDrop();}
else if(ig.input.pressed('lbtn')&&this.isMouseInside())
{this.posDelta.x=mouse_x-this.pos.x;this.posDelta.y=mouse_y-this.pos.y;this.isClicked=true;this.dragOrigin=this.pos;this.onDragStart();}
else
{this.isClicked=false;}},onDragStart:function()
{},onDrop:function()
{},isMouseInside:function()
{var entities=ig.game.entitiesUnderMouse();if(this==entities[entities.length-1])
{return true;}
return false;},checkDoubleClick:function()
{if(ig.input.pressed('lbtn')&&this.isMouseInside())
{if(this.checkForDoubleClick&&(this.doubleClickTimer.delta()<0))
{this.onDoubleClick();}
else
{this.doubleClickTimer.reset();}
this.checkForDoubleClick=false;}
else
{this.checkForDoubleClick=true;}},onDoubleClick:function()
{},update:function()
{if(ig.game.gameActive)
{if(this.draggable)this.dragAndDrop(false,true);this.checkDoubleClick();}
this.parent();},draw:function()
{this.parent();}});})

// lib/game/entities/tools/tap.js
ig.baked=true;ig.module('game.entities.tools.tap').requires('game.entities.bases.base').defines(function()
{EntityTap=EntityBase.extend({name:'tap',_wmIgnore:false,size:{x:150,y:150},animSheet:new ig.AnimationSheet('media/tools/tap.png',150,150),draggable:false,engaged:false,pourSound:new ig.Sound('media/sound/pour.ogg'),tool:null,init:function(x,y,settings)
{this.addAnim('off',1,[0],true);this.addAnim('on',1,[1],true);this.addAnim('flowing',.2,[2,3,4,5,6,7,8,9,10,11,12,13,14],false);this.parent(x,y,settings);},refillTool:function(tool)
{if(!tool||this.engaged)return;if(tool.empty&&!tool.autoRefill)
{this.tool=tool;tool.zIndex=-1000;ig.game.sortEntitiesDeferred();this.engaged=true;var onComplete=function(){this.beginRefill()}.bind(this);tool.tween({pos:{x:this.pos.x+tool.refillOffset.x,y:this.pos.y+tool.refillOffset.y}},.2,{easing:ig.Tween.Easing.Quadratic.EaseOut,onComplete:onComplete,}).start();}},beginRefill:function()
{this.tool.refill();this.currentAnim=this.anims['flowing'];this.pourSound.play();State.score+=50;},update:function()
{if(this.engaged)
{if(!this.tool.empty)
{this.engaged=false;this.currentAnim=this.anims['off'];this.pourSound.stop();var onComplete=function(){this.beginRefill()}.bind(this);var tool=this.tool
tool.tween({pos:tool.originPos},.2,{easing:ig.Tween.Easing.Quadratic.EaseOut,}).start();}}
this.parent();}});});

// lib/game/entities/bases/basetool.js
ig.baked=true;ig.module('game.entities.bases.basetool').requires('game.entities.bases.base').defines(function()
{EntityBasetool=EntityBase.extend({_wmIgnore:false,size:{x:150,y:150},originPos:{x:0,y:0},animSheet:new ig.AnimationSheet('media/tools/fertiliser.png',150,150),activeSound:new ig.Sound('media/sound/pickup.ogg'),deactiveSound:new ig.Sound('media/sound/putdown.ogg'),refilledSound:new ig.Sound('media/sound/ping.ogg'),refillOffset:{x:0,y:0},deploySpeed:0.2,deployLoops:1,refillSpeed:0.5,movementSpeed:0.25,deployOffset:{x:0,y:0},fillLevel:1,emptyRate:.2,empty:false,refilling:false,benefit:'fertiliser',status:'idle',isTool:true,autoRefill:false,active:false,deploying:false,draggable:false,targetPlant:null,init:function(x,y,settings)
{this.initAnimation()
this.parent(x,y,settings);},initAnimation:function()
{var deployFrames=[4];for(var i=0;i<this.deployLoops;i++)
{deployFrames.push(5,6);}
deployFrames.push(7,8);this.addAnim('idle',1,[0],true);this.addAnim('active',1,[1],true);this.addAnim('empty',1,[2],true);this.addAnim('emptyactive',1,[3],true);this.addAnim('refilling',this.refillSpeed,[9,10,11,12,13,14,15],true);this.addAnim('deploying',this.deploySpeed,deployFrames,true);this.currentAnim=this.anims['idle'];this.originPos=this.pos;if(this.fillLevel<=0)this.setEmpty();},toggleActive:function()
{if(!this.deploying&&!this.refilling)
{if(this.active)
{ig.game.selectedTool=null;this.deactivate(true);}
else
{ig.game.selectedTool=this;this.activate();}}},activate:function()
{if(this.empty)
{this.currentAnim=this.anims['emptyactive'];}
else
{this.active=true;this.currentAnim=this.anims['active'];}
this.activeSound.play();for(var i=0;i<ig.game.entities.length;i++)
{var entity=ig.game.entities[i];if(entity!=this&&entity.isTool)
{if(!entity.deploying)
{entity.deactivate(false);}}}},deactivate:function(playSound)
{if(this.refilling)return false;this.active=false;if(this.empty&&!this.autoRefill)
{this.currentAnim=this.anims['empty'];}
else
{this.currentAnim=this.anims['idle'];}
if(playSound)this.deactiveSound.play();},deploy:function(plant)
{if(!this.deploying&&!this.empty&&!plant.dead)
{this.targetPlant=plant;this.targetPlant.engagedWithTool=true;this.deploying=true;this.zIndex=9999;ig.game.sortEntitiesDeferred();ig.game.selectedTool=null;var targetX=(plant.pos.x-this.size.x)+this.deployOffset.x;var targetY=(plant.pos.y-this.size.y)+this.deployOffset.y;var onComplete=function(){this.onTargetPlantReached()}.bind(this);this.tween({pos:{x:targetX,y:targetY}},this.movementSpeed,{easing:ig.Tween.Easing.Quadratic.EaseOut,onComplete:onComplete,}).start();}},onTargetPlantReached:function()
{if(this.targetPlant.dead)
{this.returnToOrigin();return}
var hadConcern=false;if(this.targetPlant.concerns[this.benefit])
{hadConcern=true;}
this.currentAnim=this.anims['deploying'].rewind();if(this.deploySound)this.deploySound.play();this.fillLevel-=this.emptyRate;this.targetPlant.updateStatus(this.benefit,this.emptyRate)
if(this.fillLevel<0)this.fillLevel=0;if(hadConcern&&!this.targetPlant.concerns[this.benefit])
{State.score+=100;}},returnToOrigin:function()
{this.targetPlant.engagedWithTool=false;var onComplete=function(){this.onDeploymentComplete();}.bind(this);if(this.deploySound)this.deploySound.stop();this.tween({pos:this.originPos,},this.movementSpeed,{easing:ig.Tween.Easing.Quadratic.EaseIn,onComplete:onComplete,}).start();},onDeploymentComplete:function()
{this.zIndex=-9999;ig.game.sortEntitiesDeferred();this.deploying=false;this.deactivate(false);if(this.fillLevel<=0)this.setEmpty();},setEmpty:function()
{this.empty=true;this.currentAnim=this.anims['empty'];if(this.autoRefill)this.refill();},refill:function()
{this.currentAnim=this.anims['refilling'].rewind();},onRefillComplete:function()
{this.empty=false;this.fillLevel=1
this.refilling=false;this.deactivate(false);this.refilledSound.play();if(ig.game.selectedTool==this)
{ig.game.selectedTool=null;}},update:function()
{if(this.currentAnim==this.anims['deploying']&&this.currentAnim.loopCount>=1)
{this.currentAnim=this.anims['idle'];this.returnToOrigin();}
else if(this.currentAnim==this.anims['refilling'])
{if(this.currentAnim.loopCount>=1)
{this.onRefillComplete();}
else
{this.refilling=true;}}
this.parent();}});});

// lib/game/entities/tools/fertiliser.js
ig.baked=true;ig.module('game.entities.tools.fertiliser').requires('game.entities.bases.basetool').defines(function()
{EntityFertiliser=EntityBasetool.extend({name:'fertiliser',benefit:'fertiliser',animSheet:new ig.AnimationSheet('media/tools/fertiliser.png',150,150),deploySound:new ig.Sound('media/sound/fertiliser.ogg'),deployOffset:{x:30,y:10},autoRefill:true,refillSpeed:1,});});

// lib/game/entities/tools/spray.js
ig.baked=true;ig.module('game.entities.tools.spray').requires('game.entities.bases.basetool').defines(function()
{EntitySpray=EntityBasetool.extend({name:'spray',benefit:'mist',animSheet:new ig.AnimationSheet('media/tools/spray.png',150,150),deploySound:new ig.Sound('media/sound/spray.ogg'),deployOffset:{x:10,y:10},refillOffset:{x:-4,y:0}});});

// lib/game/entities/tools/wateringcan.js
ig.baked=true;ig.module('game.entities.tools.wateringcan').requires('game.entities.bases.basetool').defines(function()
{EntityWateringcan=EntityBasetool.extend({name:'wateringcan',benefit:'water',animSheet:new ig.AnimationSheet('media/tools/watering-can.png',150,150),deploySound:new ig.Sound('media/sound/watercan.ogg'),deployOffset:{x:25,y:-5},refillOffset:{x:-5,y:35}});});

// lib/game/levels/main.js
ig.baked=true;ig.module('game.levels.main').requires('impact.image','game.entities.tools.tap','game.entities.tools.fertiliser','game.entities.tools.spray','game.entities.tools.wateringcan').defines(function(){LevelMain={"entities":[{"type":"EntityTap","x":480,"y":45,"settings":{"zIndex":-99999}},{"type":"EntityFertiliser","x":568,"y":-16,"settings":{"zIndex":-9999}},{"type":"EntitySpray","x":644,"y":-16,"settings":{"zIndex":-9999}},{"type":"EntityWateringcan","x":740,"y":-16,"settings":{"zIndex":-9999}}],"layer":[{"name":"background","width":10,"height":7,"linkWithCollision":false,"visible":1,"tilesetName":"media/playfield/playfield-underlay.jpg","repeat":false,"preRender":true,"distance":"1","tilesize":100,"foreground":false,"data":[[1,2,3,4,5,6,7,8,9,10],[11,12,13,14,15,16,17,18,19,20],[21,22,23,24,25,26,27,28,29,30],[31,32,33,34,35,36,37,38,39,40],[41,42,43,44,45,46,47,48,49,50],[51,52,53,54,55,56,57,58,59,60],[61,62,63,64,65,66,67,68,69,70]]}]};LevelMainResources=[new ig.Image('media/playfield/playfield-underlay.jpg')];});

// lib/game/utils/assetloader.js
ig.baked=true;ig.module('game.utils.assetloader').requires('impact.game').defines(function(){AssetLoader=ig.Game.extend({asset0:new ig.Image('media/ui/badbrowser.png'),asset1:new ig.Image('media/ui/bg-endscreen-1.png'),asset2:new ig.Image('media/ui/bg-endscreen-2.png'),asset3:new ig.Image('media/ui/bg.jpg'),asset4:new ig.Image('media/ui/btn-back.png'),asset5:new ig.Image('media/ui/btn-facebook-2.png'),asset6:new ig.Image('media/ui/btn-facebook.png'),asset7:new ig.Image('media/ui/btn-instruct-left.png'),asset8:new ig.Image('media/ui/btn-instruct-right.png'),asset9:new ig.Image('media/ui/btn-instructions.png'),asset10:new ig.Image('media/ui/btn-leaderboard.png'),asset11:new ig.Image('media/ui/btn-play-small.png'),asset12:new ig.Image('media/ui/btn-play.png'),asset13:new ig.Image('media/ui/btn-playagain.png'),asset14:new ig.Image('media/ui/btn-score-left-lose.png'),asset15:new ig.Image('media/ui/btn-score-left-win.png'),asset16:new ig.Image('media/ui/btn-score-right-lose.png'),asset17:new ig.Image('media/ui/btn-score-right-win.png'),asset18:new ig.Image('media/ui/btn-sendfriend-back.png'),asset19:new ig.Image('media/ui/btn-sendfriend-send.png'),asset20:new ig.Image('media/ui/btn-sendfriend.png'),asset21:new ig.Image('media/ui/btn-skip.png'),asset22:new ig.Image('media/ui/btn-sound.png'),asset23:new ig.Image('media/ui/btn-submitscore.png'),asset24:new ig.Image('media/ui/btn-tellmore.png'),asset25:new ig.Image('media/ui/btn-twitter-2.png'),asset26:new ig.Image('media/ui/btn-twitter.png'),asset27:new ig.Image('media/ui/input-error-1.png'),asset28:new ig.Image('media/ui/input-error-2.png'),asset29:new ig.Image('media/ui/input-error-3.png'),asset30:new ig.Image('media/ui/input-error-sendfriend.png'),asset31:new ig.Image('media/ui/instruct-0.png'),asset32:new ig.Image('media/ui/instruct-1.png'),asset33:new ig.Image('media/ui/instruct-2.png'),asset34:new ig.Image('media/ui/instruct-3.png'),asset35:new ig.Image('media/ui/instruct-4.png'),asset36:new ig.Image('media/ui/instruct-5.png'),asset37:new ig.Image('media/ui/instruct-bg.png'),asset38:new ig.Image('media/ui/leaderboard-bg.png'),asset39:new ig.Image('media/ui/leaderboard-row.png'),asset40:new ig.Image('media/ui/message.png'),asset41:new ig.Image('media/ui/messages.png'),asset42:new ig.Image('media/ui/preloader.png'),asset43:new ig.Image('media/ui/prize.png'),asset44:new ig.Image('media/ui/score-message.png'),asset45:new ig.Image('media/ui/scores-loading.png'),asset46:new ig.Image('media/ui/scroll-face.png'),asset47:new ig.Image('media/ui/scroll-track.png'),asset48:new ig.Image('media/ui/sendfriend-bg.png'),asset49:new ig.Image('media/ui/share.png'),asset50:new ig.Image('media/ui/submitscore-bg.png'),asset51:new ig.Image('media/ui/tamba.png'),asset52:new ig.Image('media/ui/terms-bg.png'),asset53:new ig.Image('media/ui/title-bg.png')});});

// lib/game/entities/message.js
ig.baked=true;ig.module('game.entities.message').requires('plugins.impact-tween.tween','game.entities.bases.base').defines(function()
{EntityMessage=EntityBase.extend({size:{x:493,y:81},collides:ig.Entity.COLLIDES.NONE,animSheet:new ig.AnimationSheet('media/messages.png',493,79),animSpeed:30,timer:null,holdDuration:1,exiting:false,complete:false,init:function(x,y,settings)
{this.parent(x,y,settings);this.initAnims();this.timer=new ig.Timer();},initAnims:function()
{this.addAnim('getready',this.animSpeed,[0],true);this.addAnim('levelup',this.animSpeed,[1],true);this.addAnim('gameover',this.animSpeed,[2],true);this.addAnim('plantdead',this.animSpeed,[3],true);},showMessage:function(id)
{this.pos.x=-this.size.x
this.pos.y=((Config.size.y-this.size.y)/2)+40;this.timer.reset();this.complete=false;this.exiting=false;var onComplete=function()
{this.onEnterComplete()}.bind(this);this.tween({pos:{x:(Config.size.x-this.size.x)/2}},.5,{delay:.5,easing:ig.Tween.Easing.Back.EaseOut,onComplete:onComplete}).start();this.currentAnim=this.anims[id];},startExit:function()
{if(!this.exiting)
{var onComplete=function()
{this.onExitComplete()}.bind(this);this.tween({pos:{x:Config.size.x}},.5,{easing:ig.Tween.Easing.Back.EaseIn,onComplete:onComplete}).start();this.exiting=true;}},onEnterComplete:function()
{this.timer.reset();},onExitComplete:function()
{if(!this.complete)
{this.complete=true;}},update:function()
{this.parent();if(this.timer.delta()>this.holdDuration)
{this.startExit();}},draw:function()
{this.parent();}});});

// lib/game/entities/icons/icon.js
ig.baked=true;ig.module('game.entities.icons.icon').requires('impact.entity').defines(function()
{EntityIcon=ig.Entity.extend({_wmIgnore:true,size:{x:34,y:34},animSheet:new ig.AnimationSheet('media/icons/icons.png',34,34),monitoringType:'',plant:null,index:0,type:'',ignoreMouse:true,init:function(x,y,settings)
{this.parent(x,y,settings);this.addAnim('fertiliser',1,[0],true);this.addAnim('heat',1,[1],true);this.addAnim('light',1,[2],true);this.addAnim('mist',1,[3],true);this.addAnim('water',1,[4],true);this.currentAnim=this.anims[this.type];},update:function()
{this.parent();this.pos.x=this.getXPos();this.pos.y=this.plant.pos.y;this.zIndex=this.plant.zIndex+(this.index+1);ig.game.sortEntitiesDeferred();},getXPos:function()
{return this.plant.pos.x-this.plant.offset.x+this.plant.iconPos.x+(this.index*18)},setIndex:function(index)
{this.index=index;},});})

// lib/game/entities/icons/bubble.js
ig.baked=true;ig.module('game.entities.icons.bubble').requires('impact.entity').defines(function()
{EntityBubble=ig.Entity.extend({_wmIgnore:true,size:{x:134,y:1215},animSheet:new ig.AnimationSheet('media/icons/bubbles.png',134,129),plant:null,index:0,type:'',ignoreMouse:true,offset:{x:-30,y:130},holdTimer:null,holdDuration:1,exiting:false,init:function(x,y,settings)
{this.addAnim('water_left',1,[0],true);this.addAnim('water_right',1,[1],true);this.addAnim('mist_left',1,[2],true);this.addAnim('mist_right',1,[3],true);this.addAnim('light_left',1,[4],true);this.addAnim('light_right',1,[5],true);this.addAnim('heat_left',1,[6],true);this.addAnim('heat_right',1,[7],true);this.addAnim('fertiliser_left',1,[8],true);this.addAnim('fertiliser_right',1,[9],true);this.parent(x,y,settings);var animName=this.type+'_left';this.currentAnim=this.anims[animName];this.holdTimer=new ig.Timer();if(this.plant.pos.x<480)
{this.currentAnim=this.anims[this.type+'_left'];this.offset.x=-30;}
else
{this.currentAnim=this.anims[this.type+'_right'];this.offset.x=160;}},update:function()
{this.parent();this.pos.x=this.getXPos();this.pos.y=this.plant.pos.y;this.zIndex=this.plant.zIndex+(this.index+1);ig.game.sortEntitiesDeferred();if(this.holdTimer.delta()>this.holdDuration)
{this.startExit();this.plant.removeBubble(this.type);}
else
{}},startExit:function()
{if(!this.exiting)
{this.setFade('out',.5,true);this.exiting=true;}},getXPos:function()
{return this.plant.pos.x},setIndex:function(index)
{this.index=index;},});})

// lib/game/entities/bases/baseplant.js
ig.baked=true;ig.module('game.entities.bases.baseplant').requires('game.entities.bases.base','game.entities.icons.icon').defines(function()
{EntityBaseplant=EntityBase.extend({collides:ig.Entity.COLLIDES.NONE,size:{x:272,y:225},states:['healthy','dying','dead'],thudSound:new ig.Sound('media/sound/thud.ogg'),deadSound:new ig.Sound('media/sound/deadplant.ogg'),isPlant:true,engagedWithTool:false,displayedOnStatusMonitor:false,vitality:1,dead:false,status:{water:0,mist:0,heat:0,light:0,fertiliser:0},desires:{water:.5,mist:.5,heat:.5,light:.5,fertiliser:.5},concerns:{water:false,mist:false,heat:false,light:false,fertiliser:false},decayRates:{water:0.0002,mist:0.0002,fertiliser:0.0001},decayMultiplier:2,leeway:.2,icons:[],iconPos:{x:20,y:50},bubbles:[],init:function(x,y,settings)
{for(var s in this.desires)
{this.status[s]=this.desires[s];}
for(var i=0;i<this.states.length;i++)
{this.addAnim(this.states[i],1,[i],true);}
this.currentAnim=this.anims['healthy'];this.parent(x,y,settings);},setDifficulty:function(difficulty)
{if(ig.game.totalPlants==0)
{this.status.water=.1;this.decayMultiplier=difficulty*3;ig.game.totalPlants++;}
else
{this.decayMultiplier=difficulty*.7;}},onDrop:function()
{var gridCoords=this.grid.pixelsToCoord(this.pos.x,this.pos.y);this.addToGrid(gridCoords.x,gridCoords.y,true);if(this.dragDistance>10)
{this.thudSound.play();}},onDoubleClick:function()
{ig.game.launchStatusMonitor(this);},updateAllStatuses:function()
{if(!this.engagedWithTool&&!this.dead)
{this.updateStatus('water',-this.decayRates.water*this.decayMultiplier);this.updateStatus('mist',-this.decayRates.mist*this.decayMultiplier);this.updateStatus('fertiliser',-this.decayRates.fertiliser*this.decayMultiplier);}
var lightLevel=this.grid.getLightLevel(this.gridPos.x,this.gridPos.y);this.setStatus('light',lightLevel);var heatLevel=this.grid.getHeatLevel(this.gridPos.x,this.gridPos.y);this.setStatus('heat',heatLevel);},updateStatus:function(type,amount)
{var newAmount=this.status[type]+amount*Config.gameSpeed;if(newAmount<0)newAmount=0;else if(newAmount>1)newAmount=1;this.status[type]=newAmount;this.checkStatuses()},setStatus:function(type,amount)
{if(this.status[type])
{var newAmount=amount;if(newAmount<0)newAmount=0;else if(newAmount>1)newAmount=1;this.status[type]=newAmount;}},checkStatuses:function()
{for(var s in this.status)
{var current=this.status[s]
var desire=this.desires[s];var diff=Math.abs(current-desire);var leeway=this.leeway;if(s=='light'){leeway=0;}
if(diff>leeway)
{this.addConcern(s)}
else
{this.removeConcern(s)}}},addConcern:function(type)
{if(!this.concerns[type])
{this.addBubble(type);this.concerns[type]=true;this.addIcon(type);}},removeConcern:function(type)
{if(this.concerns[type])
{this.concerns[type]=false;this.removeIcon(type);}},updateVitality:function()
{if(this.dead)return false;var totalConcerns=0;var modifier=0;for(var c in this.concerns)
{if(this.concerns[c])
{totalConcerns++;}}
if(totalConcerns==5){modifier=-30;}
else if(totalConcerns==4){modifier=-20;}
else if(totalConcerns==3){modifier=-10;}
else if(totalConcerns==2){modifier=10;}
else if(totalConcerns==1){modifier=20;}
else if(totalConcerns==0){modifier=30;}
modifier*=.0001;var newAmount=this.vitality+modifier;if(newAmount<0)newAmount=0;else if(newAmount>1)newAmount=1;this.vitality=newAmount;if(this.vitality>.75)this.currentAnim=this.anims['healthy'];else if(this.vitality>.25)this.currentAnim=this.anims['dying'];else this.currentAnim=this.anims['dead'];if(this.vitality<=0)
{this.die();}},die:function()
{this.dead=true;this.deadSound.play();ig.game.showMessage('plantdead');this.setFade('out',.5,true);this.onDeathComplete();if(State.lives>0)State.lives--;for(var i=0;i<this.icons.length;i++)
{this.icons[i].kill();}},onDeathComplete:function()
{if(State.lives>0)ig.game.spawnPlant(this.className);},addBubble:function(type)
{var settings={plant:this,index:this.bubbles.length,type:type,span:.25,fadeValue:'in',name:'name'}
var bubble=ig.game.spawnEntity('EntityBubble',0,0,settings);this.bubbles.push(bubble);},removeBubble:function(type)
{for(var i=0;i<this.bubbles.length;i++)
{if(this.bubbles[i].type==type)
{this.bubbles.splice(i,1);break;}}},addIcon:function(type)
{var iconExists=false;for(var i=0;i<this.icons.length;i++)
{if(this.icons[i].type==type)
{return;}}
var settings={plant:this,index:this.icons.length,type:type}
var icon=ig.game.spawnEntity('EntityIcon',0,0,settings);this.icons.push(icon);},removeIcon:function(type)
{for(var i=0;i<this.icons.length;i++)
{if(this.icons[i].type==type)
{this.icons[i].kill();this.icons.splice(i,1);break;}}
for(var i=0;i<this.icons.length;i++)
{this.icons[i].setIndex(i);}},totalConcerns:function()
{var totalConcerns=0;for(var c in this.concerns)
{if(this.concerns[c])
{totalConcerns++;}}
return totalConcerns;},update:function()
{if(this.engagedWithTool||this.dead)
{this.draggable=false;}
else if(ig.game.selectedTool&&!ig.game.selectedTool.empty)
{this.draggable=false;if(ig.input.pressed('lbtn')&&this.isMouseInside()&&!ig.game.isMouseOverTools())
{ig.game.selectedTool.deploy(this);}}
else
{this.draggable=true;}
if(!this.dead&&ig.game.gameActive)
{this.updateAllStatuses();this.checkStatuses();this.updateVitality();}
this.parent();}});});

// lib/game/entities/plants/zamioculcas.js
ig.baked=true;ig.module('game.entities.plants.zamioculcas').requires('game.entities.bases.baseplant').defines(function()
{EntityZamioculcas=EntityBaseplant.extend({className:'EntityZamioculcas',plantName:['Zamioculcas','Zamiifolia'],size:{x:167,y:139},offset:{x:80,y:100},animSheet:new ig.AnimationSheet('media/plants/zamioculcas.png',167,139),desires:{water:.5,mist:1,heat:.4,light:.8,fertiliser:.5},});});

// lib/game/entities/plants/citrus.js
ig.baked=true;ig.module('game.entities.plants.citrus').requires('game.entities.bases.baseplant').defines(function()
{EntityCitrus=EntityBaseplant.extend({className:'EntityCitrus',plantName:['Citrus','x Limon'],size:{x:138,y:127},offset:{x:70,y:95},iconPos:{x:13,y:50},animSheet:new ig.AnimationSheet('media/plants/citrus.png',138,127),desires:{water:0.25,mist:.4,heat:.5,light:1,fertiliser:.8},});});

// lib/game/entities/plants/dionaea.js
ig.baked=true;ig.module('game.entities.plants.dionaea').requires('game.entities.bases.baseplant').defines(function()
{EntityDionaea=EntityBaseplant.extend({className:'EntityDionaea',plantName:['Dionaea','Muscipula'],size:{x:120,y:110},offset:{x:60,y:78},iconPos:{x:5,y:50},animSheet:new ig.AnimationSheet('media/plants/dionaea.png',120,110),desires:{water:.75,mist:.15,heat:.6,light:.8,fertiliser:.2},});});

// lib/game/entities/plants/dracaena.js
ig.baked=true;ig.module('game.entities.plants.dracaena').requires('game.entities.bases.baseplant').defines(function()
{EntityDracaena=EntityBaseplant.extend({className:'EntityDracaena',plantName:['Dracaena','Fragrans'],size:{x:138,y:166},offset:{x:70,y:130},animSheet:new ig.AnimationSheet('media/plants/dracaena.png',138,166),desires:{water:.5,mist:.6,heat:.9,light:.4,fertiliser:.8},});});

// lib/game/entities/plants/calathea.js
ig.baked=true;ig.module('game.entities.plants.calathea').requires('game.entities.bases.baseplant').defines(function()
{EntityCalathea=EntityBaseplant.extend({className:'EntityCalathea',plantName:['Calathea','Zebrina'],size:{x:186,y:160},offset:{x:88,y:125},animSheet:new ig.AnimationSheet('media/plants/calathea.png',186,160),desires:{water:.5,mist:.2,heat:.6,light:.4,fertiliser:.5},});});

// lib/game/entities/plants/euphorbia.js
ig.baked=true;ig.module('game.entities.plants.euphorbia').requires('game.entities.bases.baseplant').defines(function()
{EntityEuphorbia=EntityBaseplant.extend({className:'EntityEuphorbia',plantName:['Euphorbia','Pulcherrima'],size:{x:144,y:121},offset:{x:69,y:85},animSheet:new ig.AnimationSheet('media/plants/euphorbia.png',144,121),desires:{water:.5,mist:.6,heat:.4,light:1,fertiliser:.8},});});

// lib/game/entities/monitor/statusbar.js
ig.baked=true;ig.module('game.entities.monitor.statusbar').requires('impact.entity').defines(function()
{EntityStatusbar=ig.Entity.extend({_wmIgnore:true,size:{x:283,y:48},animSheet:new ig.AnimationSheet('media/status-monitor/bars.png',283,48),monitoringType:'',init:function(x,y,settings)
{this.parent(x,y,settings);this.addAnim('water',1,[0],true);this.addAnim('mist',1,[1],true);this.addAnim('light',1,[2],true);this.addAnim('heat',1,[3],true);this.addAnim('fertiliser',1,[4],true);this.currentAnim=this.anims['water'];},setMonitoring:function(type)
{this.monitoringType=type;this.currentAnim=this.anims[type];}});})

// lib/game/entities/monitor/statusglow.js
ig.baked=true;ig.module('game.entities.monitor.statusglow').requires('impact.entity').defines(function()
{EntityStatusglow=ig.Entity.extend({_wmIgnore:true,size:{x:300,y:74},animSheet:new ig.AnimationSheet('media/status-monitor/glow.png',300,74),monitoringType:'',init:function(x,y,settings)
{this.parent(x,y,settings);this.addAnim('on',1,[0],true);this.currentAnim=this.anims['off'];},setMonitoring:function(type)
{this.monitoringType=type;}});})

// lib/game/entities/monitor/statusideal.js
ig.baked=true;ig.module('game.entities.monitor.statusideal').requires('impact.entity').defines(function()
{EntityStatusideal=ig.Entity.extend({_wmIgnore:true,size:{x:10,y:44},animSheet:new ig.AnimationSheet('media/status-monitor/ideal.png',10,44),monitoringType:'',init:function(x,y,settings)
{this.parent(x,y,settings);this.addAnim('ideal',1,[0],true);},setMonitoring:function(type)
{this.monitoringType=type;},updatePosition:function(min,max)
{this.anims.ideal.sheet.width=Math.abs(max-min);this.pos.x=min;}});})

// lib/game/entities/monitor/statusmonitor.js
ig.baked=true;ig.module('game.entities.monitor.statusmonitor').requires('impact.entity','plugins.impact-tween.tween','game.entities.monitor.statusbar','game.entities.monitor.statusglow','game.entities.monitor.statusideal').defines(function()
{StatusMonitor=ig.Entity.extend({size:{x:960,y:640},overlay:new ig.Image('media/status-monitor/overlay.png'),underlay:new ig.Image('media/status-monitor/underlay.png'),nameFont:new ig.Font('media/fonts/arial-rounded-30-black.png'),activeSound:new ig.Sound('media/sound/pickup.ogg'),deactiveSound:new ig.Sound('media/sound/putdown.ogg'),plant:null,displayPlant:null,active:false,hideable:false,hideTimer:new ig.Timer(),barSettings:{water:{y:180},mist:{y:245},light:{y:311},heat:{y:377},fertiliser:{y:444}},bars:[],barX:230,barMaxX:470,totalBars:0,glows:[],glowX:457,ideals:[],idealX:490,glowSettings:{water:{y:164},mist:{y:230},light:{y:296},heat:{y:362},fertiliser:{y:429}},init:function(x,y,settings)
{this.initBars();this.parent(x,y,settings);},initBars:function()
{for(var s in this.barSettings)
{var statusBar=new EntityStatusbar(0,0);statusBar.pos.x=this.barX;statusBar.pos.y=this.barSettings[s].y;statusBar.setMonitoring(s);this.bars.push(statusBar);var glow=new EntityStatusglow(0,0);glow.pos.x=this.glowX;glow.pos.y=this.glowSettings[s].y;this.glows.push(glow)
var ideal=new EntityStatusideal(0,0);ideal.pos.x=600;ideal.pos.y=this.glowSettings[s].y+16;this.ideals.push(ideal);ideal.setMonitoring(s);}
this.totalBars=this.bars.length;},setPlant:function(plant)
{this.hideable=false;this.active=true;this.hideTimer.reset();this.plant=plant;this.displayPlant=new(eval(plant.className));this.displayPlant.displayedOnStatusMonitor=true;this.displayPlant.pos={x:335,y:350};this.activeSound.play();},update:function()
{if(this.plant)
{if(this.hideTimer.delta()>.25)
{this.hideable=true;}
var j=this.totalBars;for(var i=0;i<j;i++)
{var bar=this.bars[i];var glow=this.glows[i];var diff=this.barMaxX-this.barX;var monitorType=bar.monitoringType;var attributeValue=this.plant.status[monitorType];bar.pos.x=(diff*attributeValue)+this.barX
if(this.plant.concerns[monitorType])
{glow.currentAnim=glow.anims['on'];}
else
{glow.currentAnim=glow.anims['off'];}
var ideal=this.ideals[i];monitorType=ideal.monitoringType;attributeValue=this.plant.desires[monitorType];var attrMin=this.plant.desires[monitorType]-this.plant.leeway;var attrMax=this.plant.desires[monitorType]+this.plant.leeway;var min=(diff*attrMin)+this.idealX;var max=(diff*attrMax)+this.idealX;ideal.updatePosition(min,max);}
if(this.plant.dead)
{this.hide();}}
this.parent();},draw:function()
{this.parent();if(this.plant)
{this.underlay.draw(470,180);var j=this.totalBars;for(var i=0;i<j;i++)
{this.bars[i].draw();}
for(var i=0;i<j;i++)
{this.ideals[i].draw();}
this.overlay.draw(0,0);if(this.displayPlant)this.displayPlant.draw();var textX=340;var textY=432;this.nameFont.draw(this.plant.plantName[0],textX,textY,ig.Font.ALIGN.CENTER);this.nameFont.draw(this.plant.plantName[1],textX,textY+32,ig.Font.ALIGN.CENTER);for(var i=0;i<j;i++)
{this.glows[i].draw();}}},hide:function()
{if(this.displayPlant)
{this.hideTimer.reset();this.displayPlant.kill();this.displayPlant=null;this.deactiveSound.play();}
this.active=false;}});})

// lib/game/main.js
ig.baked=true;ig.module('game.main').requires('impact.game','impact.font','impact.sound','plugins.empika.game_utilities','plugins.preloader','game.facebook','game.grid','game.hud','game.screenmanager','game.screens.footer','game.screens.social','game.screens.sound','game.levels.main','game.utils.assetloader','game.entities.message','game.entities.icons.icon','game.entities.icons.bubble','game.entities.plants.zamioculcas','game.entities.plants.citrus','game.entities.plants.dionaea','game.entities.plants.dracaena','game.entities.plants.calathea','game.entities.plants.euphorbia','game.entities.monitor.statusmonitor').defines(function(){Koubachi=ig.Game.extend({coordScale:1,mode:'ui',nextScreen:'title',skipIntro:false,introPlaying:false,fbid:'',fbEmail:'',gameWin:false,music:new ig.Music('media/sound/music_game.ogg'),levelUpSound:new ig.Sound('media/sound/levelup.ogg'),light:new ig.Image('media/playfield/playfield-light.png'),plants:['Dracaena','Zamioculcas','Euphorbia','Citrus','Calathea','Dionaea'],gameActive:false,toolMouseDown:false,itemCarried:false,totalPlants:0,grid:null,hud:null,statusMonitor:null,selectedTool:null,screenManager:null,social:null,footer:null,sound:null,facebook:new Facebook(),message:null,messageCallback:null,levelProgression:[25,65,125,215,325],levelProgressionIndex:0,init:function()
{if(_facebook==1)
{this.coordScale=1.25;}
if(isMobile)
{this.skipIntro=true;}
ig.input.initMouse();ig.input.bind(ig.KEY.MOUSE1,'lbtn');ig.music.add('media/sound/music_game.ogg');this.levelProgressionIndex=0;this.initSocial();this.initFooter();this.initSoundManager();this.initScreenManager();},initScreenManager:function()
{$('#screens').css('display','block');this.mode='ui';this.screenManager=new ScreenManager(this.nextScreen);this.toggleFooter(true);},resumeScreenManager:function()
{$('#screens').css('display','block');this.mode='ui';this.screenManager.switchScreen(this.nextScreen);this.toggleFooter(true);},resetState:function()
{State={score:0,level:0,lives:3};},initGame:function()
{this.totalPlants=0;this.levelProgressionIndex=0;this.mode='game';this.resetState();this.grid=new Grid();this.hud=new HUD();this.statusMonitor=new StatusMonitor();this.loadLevel(LevelMain);this.increaseLevel();this.success=false;this.complete=false;this.toggleFooter(false);$('#screens').css({'display':'none'});this.showMessage('getready',this.startGame)
this.gameWin=false;},startGame:function()
{this.hud.toggleTimer(true);this.gameActive=true;ig.music.play();},endGame:function(success)
{if(this.gameActive)
{this.gameActive=false;this.hud.toggleTimer(false);this.success=success;this.showMessage('gameover',this.gameOver);}
return true;},gameOver:function()
{this.nextScreen='submitscore';this.statusMonitor.hide();this.resumeScreenManager();ig.music.stop();},increaseLevel:function(animated)
{var plant=this.spawnPlant('Entity'+this.plants[State.level]);State.level++;plant.setDifficulty(State.level);},spawnPlant:function(type)
{var gridCoord=this.grid.getRandomFreeCoord();var fadeSettings={span:1,fadeValue:'stop',name:'name',}
var plant=this.spawnEntity(eval(type),0,0,fadeSettings);plant.addToGrid(gridCoord.x,gridCoord.y);return plant;},showMessage:function(id,callback)
{if(!this.message)
{this.message=new EntityMessage(100,100,{id:id});}
this.message.showMessage(id);this.messageCallback=callback;this.statusMonitor.hide()},checkToolClicks:function()
{var mouseX=ig.input.mouse.x;var mouseY=ig.input.mouse.y;mouseX*=ig.game.coordScale;mouseY*=ig.game.coordScale;var boxLeftX=510;if(!ig.input.state('lbtn'))this.toolMouseDown=false;if(ig.input.state('lbtn')&&this.isMouseOverTools()&&!this.toolMouseDown&&!this.itemCarried)
{this.toolMouseDown=true;var toolName='';var localMouseX=mouseX-boxLeftX;if(localMouseX<68)
{toolName='tap';}
else if(localMouseX<162)
{toolName='fertiliser';}
else if(localMouseX<227)
{toolName='spray';}
else
{toolName='wateringcan';}
var tool=ig.game.getEntityByName(toolName);if(tool)
{if(toolName=='tap')
{tool.refillTool(this.selectedTool);}
else
{tool.toggleActive();}}}},isMouseOverTools:function()
{var boxLeftX=510;var mouseX=ig.input.mouse.x;var mouseY=ig.input.mouse.y;mouseX*=ig.game.coordScale;mouseY*=ig.game.coordScale;return mouseY<140&&mouseX>boxLeftX&&mouseX<850;},launchStatusMonitor:function(plant)
{if(!this.statusMonitor.active)
{this.statusMonitor.setPlant(plant);}},initFooter:function()
{this.footer=new Footer();},initSocial:function()
{this.social=new Social();},initSoundManager:function()
{this.sound=new SoundManager();},toggleFooter:function(active)
{if(!this.footer)return false;if(!active)
{this.footer.hide();}
else
{this.footer.show();}},toggleSocial:function(active)
{if(!this.social)return false;if(!active)
{this.social.hide();}
else
{this.social.show();}},toggleSoundmanager:function(active)
{if(!this.sound)return false;if(!active)
{this.sound.hide();}
else
{this.sound.show();}},checkLevelProgression:function()
{if(this.levelProgressionIndex<this.levelProgression.length)
{var nextMilestone=this.levelProgression[this.levelProgressionIndex];var currentProgress=this.hud.timerSeconds;if(currentProgress>=nextMilestone)
{this.levelProgressionIndex++;this.showMessage('levelup',this.increaseLevel);return;}}},update:function()
{if(this.screenManager)this.screenManager.update();if(State.lives<=0)
{if(this.gameActive)
{this.endGame(false)
this.gameActive=false;}}
if(this.gameActive)
{if(this.statusMonitor.active&&ig.input.state('lbtn'))
{if(this.statusMonitor.hideable)
{this.statusMonitor.hide();}}
if(this.hud)this.hud.update();if(this.statusMonitor.active)this.statusMonitor.update();this.checkToolClicks();this.checkLevelProgression();}
if(this.message)
{this.message.update(0);if(this.message.complete)
{if(this.messageCallback)this.messageCallback()
this.message.complete=false;}}
this.parent();},updateScore:function()
{var baseScore=5;var j=this.entities.length;for(var i=0;i<j;i++)
{var entity=this.entities[i];if(entity.isPlant)
{var award=Math.floor(baseScore*entity.vitality);State.score+=award;}}},draw:function()
{if(this.introPlaying)return;this.parent();if(this.mode=='ui')
{this.screenManager.draw();}
else
{if(this.light)this.light.draw(0,0);if(this.hud)this.hud.draw(0,0);if(this.message)this.message.draw(0,0);if(this.gameActive)
{if(this.statusMonitor.active)
{this.statusMonitor.draw(0,0);}}}}});if(ig.ua.mobile||BrowserDetect.browser=="Explorer")
{ig.Sound.enabled=false;}
if(ig.ua.iPhone||ig.ua.iPhone4||ig.ua.android)
{isMobile=true;}
ig.Sound.use=[ig.Sound.FORMAT.M4A,ig.Sound.FORMAT.OGG,ig.Sound.FORMAT.MP3];ig.main('#canvas',Koubachi,60,960,640,1,ig.Preloader);});